var metaType=0,metaSize=1,metaInput=2,metaFormat=3,metaUsers={US_USID:["int",0,"<input type=hidden />",""],US_NAME:["varchar",35,"<input type=text maxlength=35 />",""],US_VUNITS:["varchar",12,"<select class=vunits></select>",""],US_VIUNITS:["varchar",12,"<select class=vunits></select>",""],US_MUNITS:["varchar",12,"<select class=wunits></select>",""],US_HUNITS:["varchar",12,"<select class=wunits></select>",""],US_TUNITS:["varchar",10,"<button class='butRotate tunits' type=button></button>",function(a){return TempUnits[a]}],
US_EUNITS:["varchar",5,"<button class='butRotate eunits' type=button></button>",""],US_BOILVOL:["decimal",4.2,"<input type=text maxlength=7 class=decimal />",""],US_VOLUME:["decimal",4.2,"<input type=text maxlength=7 class=decimal />",""],US_EFF:["int",0,"<input type=text maxlength=3 class=integer />",""],US_PRIMER:["varchar",0,"",""],US_RATIO:["decimal",1.2,"",""],US_MALTCAP:["decimal",0.3,"",""],US_HOPFORM:["varchar",6,"<button type=button class=butRotate onclick='rh_formClick(this)'>Pellet</button>",
""],US_HYDROTEMP:["decimal",3.1,"<input type=text maxlength=5 class=decimal />",""],US_DATEFORMAT:["varchar",9,"",""]},LitersConvert={Barrels:117.347772,Hectoliters:100,"Imp Gallons":4.54609,Gallons:3.785412,Liters:1,Quarts:0.946353,Pints:0.4731765,Cups:0.2365883,Ounces:0.0295735,"Imp Ounces":0.0284131,Tablespoons:0.0147868,Teaspoons:0.0049289},GramsConvert={Kg:1E3,Lbs:453.59237,Ounces:28.3495231,Grams:1},TempUnits={F:"&deg;F",C:"&deg;C"},GravityUnits={SG:"SG",Plato:"&deg;Plato"},Primer={Cane:0.286,
Corn:0.27027,DME:0.135318},HopForm={Pellet:"Leaf",Leaf:"Plug",Plug:"Pellet"},HopWhen={Default:"Boil",Mash:"Fwh",Fwh:"Boil",Boil:"Dry",Dry:"Mash"},Phase={Default:"Setup",Setup:"Mash",Mash:"Boil",Boil:"Chill",Chill:"Ferment",Ferment:"Package",Package:"Setup"},Added={Default:"Mins After",Setup:"During",Package:"During",Ferment:"Days After",During:"During","Mins Before":"Mins After","Mins After":"Mins Before","Days Before":"Days After","Days After":"Days Before"},Action={Setup:"Water Prep","Water Prep":"Water Prep",
Mash:"Mash In","Mash In":"Mash Out","Mash Out":"Sparge",Sparge:"Mash In",Boil:"Boil Start","Boil Start":"Boil End","Boil End":"Boil Start",Chill:"Chill Start","Chill Start":"Chill End","Chill End":"Chill Start",Ferment:"Pitching",Pitching:"Racking",Racking:"Packaging",Packaging:"Pitching",Package:"Bottling",Bottling:"Kegging",Kegging:"Bottling"},DateType={Default:"Note",Brewed:"Racked",Racked:"Packaged",Packaged:"Sampled",Sampled:"Note",Note:"Brewed"},bihDefaults={RATIO:0.4,VIUNITS:"Quarts",HOPFORM:"Pellet",
VUNITS:"Gallons",HYDROTEMP:60,PRIMER:"Corn",EUNITS:"SG",HUNITS:"Grams",TUNITS:"F",BOILVOL:0,EFF:75,DATEMASK:"MM/DD/YYYY",MALTCAP:0.4,VOLUME:10,MUNITS:"Lbs"},incSG={inc:0.001,minInc:0.001,maxInc:0.01,minVal:0.99,maxVal:1.25,decimals:3},incSGC={inc:0.001,maxVal:1.05,minInc:0.001,maxInc:0.01,decimals:3,minVal:0},incLvb={inc:10,maxVal:999.9,minInc:1,maxInc:100,decimals:1,minVal:0},incAAU={inc:1,maxVal:20,minInc:0.1,maxInc:10,decimals:1,minVal:0},incIBU={inc:1,maxVal:200,minInc:0.1,maxInc:10,decimals:1,
minVal:0},incPlato={inc:1,minInc:0.1,maxInc:10,minVal:-2.6,maxVal:52,decimals:1},incF={inc:1,minInc:0.1,maxInc:10,minVal:0,maxVal:212,decimals:0},incC={inc:1,minInc:0.1,maxInc:10,minVal:-17.8,maxVal:100,decimals:1},incAmt={inc:1,maxVal:9999.99,minInc:0.25,maxInc:10,decimals:2,minVal:0},incPct={inc:1,maxVal:100,minInc:1,maxInc:5,decimals:0,minVal:0},incTime={inc:5,maxVal:360,minInc:1,maxInc:30,decimals:0,minVal:0},incCO2={inc:0.25,minInc:0.05,maxInc:1,minVal:0,maxVal:4,decimals:2};
alcABV=function(a,b,c){b=convertGravity(a,b,"SG");a=!c?1+(b-1)/4:convertGravity(a,c,"SG");return 131*(b-a)};alcABW=function(a,b,c){b=convertGravity(a,b,"SG");a=!c?1+(b-1)/4:convertGravity(a,c,"SG");return 105*(b-a)};alcCalories=function(a,b,c){var e=!c?1+(OGinSG-1)/4:convertGravity(a,c,"SG"),f=alcABW(a,b,c),a=alcRE(a,b,c);return 3.55*(6.9*f+4*(a-0.1))*e};alcRE=function(a,b,c){b=convertGravity(a,b,"P");a=!c?b/4:convertGravity(a,c,"P");return 0.1808*b+0.8192*a};
co2AtTemp=function(a,b){var c=convertTemp(b,a,"C");return 2>c?1.7:3>c?1.65:4>c?1.6:5>c?1.55:6>c?1.5:7>c?1.45:8>c?1.4:9>c?1.35:10>c?1.3:11>c?1.25:12>c?1.2:13>c?1.16:14>c?1.12:15>c?1.08:16>c?1.05:17>c?1.02:18>c?0.99:19>c?0.96:20>c?0.93:21>c?0.9:22>c?0.88:0.83};co2CO2FromSugar=function(a,b,c,e,f){a=convertWeight(a,b,"Grams");c=convertVolume(c,e,"Liters");return a*Primer[f]/c};
co2ForceCarbonation=function(a,b,c,e){a=convertTemp(a,b,"F");return convertPressure("PSI",-16.6999-0.0101059*a+0.00116512*a*a+0.173354*a*e+4.24267*e-0.0684226*e*e,c)};co2SugarFromCO2=function(a,b,c,e,f){c=convertVolume(c,e,"Liters");return convertWeight("Grams",b/Primer[f]*c,a)};convertGravity=function(a,b,c){b=parseFloat(b)||0;return a==c||0==b?b:"SG"==a?260-260/b:260/(260-b)};convertPressure=function(a,b,c){b=parseFloat(b)||0;return a==c?b:"PSI"==a?6.89475729316836*b:b/6.89475729316836};
convertSRM=function(a){return(1.4922*Math.pow(a,0.6859)).toFixed(1)};convertTemp=function(a,b,c){b=parseFloat(b)||0;a=a.left(1);c=c.left(1);return a==c?b:"F"==a?(b-32)/1.8:1.8*b+32};convertVolume=function(a,b,c){b=parseFloat(b)||0;return a==c?b:b*LitersConvert[a]/LitersConvert[c]};convertWeight=function(a,b,c){b=parseFloat(b)||0;return a==c?b:b*GramsConvert[a]/GramsConvert[c]};
correctGravity=function(a,b,c,e,f){c=convertTemp(c,e,"F");b=convertGravity(a,b,"SG");return convertGravity("SG",b+(1.313454-0.132674*c+0.002067793*c*c-2.627634E-6*c*c*c-(1.313454+-0.132674*f+0.002057793*f*f+-2.627634E-6*f*f*f))/1E3,a)};fldChangeEUnits=function(a,b){var c=convertGravity(b.from,a.value,b.to);a.value=formatGravity(c,b.to);return c};fldChangeVUnits=function(a,b){var c=convertVolume(b.from,a.value,b.to);a.value=c.toFixed(2);return c};
fldChangeWUnits=function(a,b){var c=convertWeight(b.from,a.value,b.to);a.value=c.toFixed(2);return c};formatGravity=function(a,b){return"SG"==b?a.toFixed(3):a.toFixed(1)};formatTemp=function(a,b){return"F"==b?a.toFixed(0):a.toFixed(1)};
ibuAmountFromIBU=function(a,b,c,e,f,g,i,h,j,l,k){b=parseFloat(b)||0;e=parseFloat(e)||1;g=parseFloat(g)||0;i=parseFloat(i)||0;j=parseFloat(j)||0;k=parseFloat(k)||0;h=ibuGetUtilization(h,j,l);if(0==b||0==g||0==i||0==h)return 0;a=convertVolume(a,b,"Liters");b=ibuCorrectionForGravity(c,e,b,k);return convertWeight("Grams",a*b*g/(1E3*(h/100*i/100)),f)};ibuCorrectionForGravity=function(a,b,c,e){a=convertGravity(a,b,"SG");0<e&&e!=c&&(a=1+c/e*(a-1));return 1.05<a?1+(a-1.05)/0.2:1};
ibuGetUtilization=function(a,b,c){return"FWH"==c?"Pellet"==a?32:30:"Dry"==c?0:"Mash"==c?15:15>=b?b/15*("Pellet"==a?12:10):30>=b?b/30*("Pellet"==a?22:20):45>=b?b/45*("Pellet"==a?26:24):60>=b?b/60*("Pellet"==a?28:26):90>=b?b/90*("Pellet"==a?32:30):"Pellet"==a?32:30};
ibuIBUFromAmount=function(a,b,c,e,f,g,i,h,j,l,k){b=parseFloat(b)||0;e=parseFloat(e)||1;g=parseFloat(g)||0;i=parseFloat(i)||0;j=parseFloat(j)||0;k=parseFloat(k)||0;if(0==b||0==g||0==i)return 0;a=convertVolume(a,b,"Liters");b=ibuCorrectionForGravity(c,e,b,k);f=convertWeight(f,g,"Grams");h=ibuGetUtilization(h,j,l);return 1E3*(f*h/100*i/100)/(a*b)};isLoggedIn=function(){return bihLoggedIn};maltCapFromMoisture=function(a){return 0.38+a/2/100};
mashDecoctionTemp=function(a,b,c,e,f,g,i,h){if(0==f)return g;a=convertVolume(a,b,"Liters");e=convertWeight(c,e,"Kg");c=convertWeight(c,f,"Kg");return-((h*e+a)/(e+a)*(e+a)/c*(g-i)-g)};mashDecoctionWeight=function(a,b,c,e,f,g,i,h){if(g==i||0==b+e)return 0;a=convertVolume(a,b,"Liters");e=convertWeight(c,e,"Kg");return convertWeight("Kg",(h*e+a)/(1+(i-f)/(g-i)),c)};
mashInfusionTemp=function(a,b,c,e,f,g,i,h){if(0==c)return g;b=convertVolume(a,b,"Liters");a=convertVolume(a,c,"Liters");e=convertWeight(e,f,"Kg");return-((h*e+b)/(e+b)*(e+b)*(g-i)-a*i)/a};mashInfusionVolume=function(a,b,c,e,f,g,i,h){if(g==i||0==b+e)return 0;b=convertVolume(a,b,"Liters");c=convertWeight(c,e,"Kg");f=(h*c+b)/(c+b)*(c+b)*(g-i)/iif(0==i-f,0.001,i-f);return convertVolume("Liters",f,a)};pctExtractFromSGC=function(a){return 1E3*(a-1)/0.4631};
popPrimer=function(a){return $(a).each(function(){var a=$(this),c;for(c in Primer){var e=$("<option></option>").attr("value",c).text(c);a.append(e)}})};popStepType=function(a){var b=["Infusion","Decoction","Heat"];return $(a).each(function(){for(var a=$(this),e=0;e<b.length;e++)a.append($("<option></option>").attr("value",b[e]).text(b[e]))})};popUnitSelect=function(a,b){return $(a).each(function(){var a=$(this),e;for(e in b){var f=$("<option></option>").attr("value",e).text(e);a.append(f)}})};
rotateDateType=function(a){return rotateSetVal(a,DateType[a.innerHTML]||DateType.Default)};rotateGravity=function(a){var b="SG"==a.value?"Plato":"SG";return rotateSetVal(a,GravityUnits[b],b)};rotateHopForm=function(a){return rotateSetVal(a,HopForm[a.innerHTML]||bihDefaults.HOPFORM)};rotateHopWhen=function(a){return rotateSetVal(a,HopWhen[a.innerHTML]||HopWhen.Default)};rotateMiscAction=function(a){return rotateSetVal(a,Action[a.innerHTML]||Action.Default)};
rotateMiscAdded=function(a){return rotateSetVal(a,Added[a.innerHTML]||Added.Default)};rotateMiscPhase=function(a,b,c){a=rotateSetVal(a,Phase[a.innerHTML]||Phase.Default);rotateSetVal(b,Added[a]||Added.Default);rotateSetVal(c,Action[a]);return a};rotateTemp=function(a){var b="F"==a.value?"C":"F";return rotateSetVal(a,TempUnits[b],b)};sgcFromPctExtract=function(a,b,c,e){0==a&&(a=c-e);return 0.4631*(1-b/100)*a/1E3+1};spinnerBind=function(a,b,c){return a.on("keydown change",b,c)};
spinnerBindGravity=function(a,b,c){return a.off("keydown change").on("keydown change","SG"==b?incSG:incPlato,c)};spinnerBindTemp=function(a,b,c){return a.off("keydown change").on("keydown change","F"==b?incF:incC,c)};unitbtnFromTo=function(a,b){var c={};c.from=a.innerHTML;c.to=rotateSetVal(a,b[c.from]||b.Default);return c};unitselFromTo=function(a){var b={};b.to="button"==a.type?a.value:selectedValue(a);b.from=a.oldvalue||b.to;a.oldvalue=b.to;return b};
unitselInit=function(a,b){a.value=b;a.oldvalue=b};popInfoURL=function(a,b){var c=$(a).closest("tr").data("rowid"),e;"g"==b?e=qryGrains.DATA[c].GR_URL||"http://www.google.com/search?q="+qryGrains.DATA[c].GR_MALTSTER+"+"+qryGrains.DATA[c].GR_TYPE:"h"==b&&(e=qryHops.DATA[c].HP_URL||"http://www.google.com/search?q="+qryHops.DATA[c].HP_HOP+"+"+qryHops.DATA[c].GR_GROWN);popOut(e,b+"PopOut")};
stylesClickRow=function(){var a=$(this).data("rowid")||0,b=$("#infoBJCPStyles");stylesScatter(qryBJCPStyles.DATA[a],b)};
stylesInit=function(){queryMakeHashable(qryBJCPStyles);for(var a=$("#tabBJCPStyles"),b=a.find("tbody"),c=b.find("tr"),e=0;e<qryBJCPStyles.DATA.length;e++){var f=c.clone();stylesScatter(qryBJCPStyles.DATA[e],f);f.attr("id","st_rowid"+e);f.data("rowid",e);b.append(f)}c.remove();$("#divtabsToolsStyles").width();a.tablescroller({id:"BJCPStyles",height:327,sort:!0,print:!1,borderWidth:1,borderColor:"#979F97"});b.find("tr").click(stylesClickRow);$("#divStylesTabs").tabs({selected:0});stylesClickRow()};
stylesScatter=function(a,b){if("infoBJCPStyles"==b.attr("id")){b.find(".st_subcategory").html(right("0"+a.ST_SUBCATEGORY,3)+" "+a.ST_STYLE);b.find(".st_substyle").html(a.ST_SUBSTYLE);b.find(".st_type").html(a.ST_TYPE);b.find(".st_og").html(a.ST_OG_MIN.toFixed(3)+" - "+a.ST_OG_MAX.toFixed(3));b.find(".st_fg").html(a.ST_FG_MIN.toFixed(3)+" - "+a.ST_FG_MAX.toFixed(3));b.find(".st_ibu").html(a.ST_IBU_MIN+" - "+a.ST_IBU_MAX);b.find(".st_srm").html(a.ST_SRM_MIN+" - "+a.ST_SRM_MAX);b.find(".st_abv").html(a.ST_ABV_MIN+
" - "+a.ST_ABV_MAX);b.find(".st_co2").html(a.ST_CO2_MIN+" - "+a.ST_CO2_MAX);b.find(".st_aroma").html(a.ST_AROMA);b.find(".st_appearance").html(a.ST_APPEARANCE);b.find(".st_flavor").html(a.ST_FLAVOR);b.find(".st_mouthfeel").html(a.ST_MOUTHFEEL);b.find(".st_impression").html(a.ST_IMPRESSION);b.find(".st_comments").html(a.ST_COMMENTS);b.find(".st_history").html(a.ST_HISTORY);b.find(".st_ingredients").html(a.ST_INGREDIENTS);b.find(".st_varieties").html(a.ST_VARIETIES);b.find(".st_exceptions").html(a.ST_EXCEPTIONS);
b.find(".st_examples").html(a.ST_EXAMPLES);var c=$("#divStylesTabs");stylesTabsDisplay(a.ST_AROMA,c,"#tabsStylesAroma");stylesTabsDisplay(a.ST_APPEARANCE,c,"#tabsStylesAppearance");stylesTabsDisplay(a.ST_FLAVOR,c,"#tabsStylesFlavor");stylesTabsDisplay(a.ST_MOUTHFEEL,c,"#tabsStylesMouthfeel");stylesTabsDisplay(a.ST_IMPRESSION,c,"#tabsStylesImpression");stylesTabsDisplay(a.ST_COMMENTS,c,"#tabsStylesComments");stylesTabsDisplay(a.ST_HISTORY,c,"#tabsStylesHistory");stylesTabsDisplay(a.ST_INGREDIENTS,
c,"#tabsStylesIngredients");stylesTabsDisplay(a.ST_VARIETIES,c,"#tabsStylesVarieties");stylesTabsDisplay(a.ST_EXCEPTIONS,c,"#tabsStylesExceptions");stylesTabsDisplay(a.ST_EXAMPLES,c,"#tabsStylesExamples");rowHighlight(b,"st_rowid",a._ROWID)}else b.find(".st_subcategory").html(right("0"+a.ST_SUBCATEGORY,3)),b.find(".st_substyle").html(a.ST_SUBSTYLE),b.find(".st_type").html(a.ST_TYPE),b.find(".st_og_min").html(a.ST_OG_MIN.toFixed(3)),b.find(".st_og_max").html(a.ST_OG_MAX.toFixed(3)),b.find(".st_fg_min").html(a.ST_FG_MIN.toFixed(3)),
b.find(".st_fg_max").html(a.ST_FG_MAX.toFixed(3)),b.find(".st_ibu_min").html(a.ST_IBU_MIN),b.find(".st_ibu_max").html(a.ST_IBU_MAX),b.find(".st_srm_min").html(a.ST_SRM_MIN),b.find(".st_srm_max").html(a.ST_SRM_MAX),b.find(".st_abv_min").html(a.ST_ABV_MIN.toFixed(1)),b.find(".st_abv_max").html(a.ST_ABV_MAX.toFixed(1))};stylesScrollTo=function(){var a=$("#tabScrollBodyBJCPStyles").find("tbody").find("#st_rowid"+selectedRow.rowid);$("#divScrollBodyBJCPStyles").scrollTo(a,800)};
stylesTabsDisplay=function(a,b,c){var e=b.find(c).hasClass("tabHide");isEmpty(a)?e||b.find("#"+c).removeClass("tabShow").addClass("tabHide"):e&&b.find("#"+c).removeClass("tabHide").addClass("tabShow")};var vol=0,grv=0,srm=0,eff=0,ibu=0;
brewlogScatter=function(a,b){b.find(".bl_name").html(a.RE_NAME);b.find(".bl_style").html(a.RE_STYLE);b.find(".bl_brewed").html(jsDateFormat(new Date(a.RE_BREWED),cfDateMask));var c=convertVolume(a.RE_VUNITS,a.RE_VOLUME,bihDefaults.VUNITS);b.find(".bl_volume").html(c.toFixed(2));var e=convertGravity(a.RE_EUNITS,a.RE_EXPGRV,bihDefaults.EUNITS);b.find(".bl_expgrv").html(formatGravity(e,bihDefaults.EUNITS));b.find(".bl_expibu").html(a.RE_EXPIBU.toFixed(1));b.find(".bl_expsrm").html(a.RE_EXPSRM.toFixed(1));
b.find(".bl_eff").html(a.RE_EFF.toFixed(0));vol+=c;grv+=e;srm+=a.RE_EXPSRM;ibu+=a.RE_EXPIBU;eff+=a.RE_EFF};
brewlogInit=function(){window.qryBrewLog||brewlogLoadLS();var a=qryBrewLog.DATA.length,b=$("#tabBrewLog"),c=b.find("tbody"),e=c.find("tr");queryMakeHashable(qryBrewLog);for(var f=0;f<qryBrewLog.DATA.length;f++){var g=e.clone();brewlogScatter(qryBrewLog.DATA[f],g);g.attr("id","bl_rowid"+f);g.data("rowid",f);g.data("pk",qryBrewLog.DATA[f].RE_REID);c.append(g)}e.remove();b.tablescroller({id:"BrewLog",height:610,sort:!0,print:!1,borderWidth:1,borderColor:"#979F97"});a&&($("#bl_cnt").html(a+addS(" record",
a)),$("#bl_total").html(vol.toFixed(2)+" "+bihDefaults.VUNITS),$("#bl_avgvolume").html((vol/a).toFixed(2)),$("#bl_avggrv").html((grv/a).toFixed(3)),$("#bl_avgibu").html((ibu/a).toFixed(0)),$("#bl_avgsrm").html((srm/a).toFixed(1)),$("#bl_avgeff").html((eff/a).toFixed(0)))};
brewlogLoadLS=function(){var a=localStorage.getItem("BIHLIST");qryBrewLog={DATA:[]};if(!a)return $("#brewlogMsg").html("There are no recipes stored locally on this computer.");for(a=a.split(",");a.length;){var b=a.pop(),b=JSON.parse(localStorage.getItem("BIHDETAIL"+b));qryBrewLog.DATA.push(b.qryRecipe.DATA[0])}};
var sch_40_60_70={"0":{ratio:1,f:40,d:30},1:{t:0,f:60,d:30},2:{t:0,f:70,d:30},3:{t:0,f:75,d:10}},sch_40_50_60_70={"0":{ratio:1,f:40,d:30},1:{t:0,f:50,d:30},2:{t:0,f:60,d:30},3:{t:0,f:70,d:30},4:{t:0,f:75,d:10}};alcEvent=function(a){"change"==a.type&&(a.which=13);spinnerInc(a);if(!a.data.changed)return!0;alcCalc()};
alcCalc=function(){var a=getById("alc_eunits").value,b=getById("alc_expgrv_i").value,c=getById("alc_expgrv_f").value;getById("alc_abv").value=alcABV(a,b,c).toFixed(1);getById("alc_abw").value=alcABW(a,b,c).toFixed(1);getById("alc_calories").value=alcCalories(a,b,c).toFixed(1)};
alcUnitsGravity=function(a){var a=unitbtnFromTo(a,GravityUnits),b=$("#alc_expgrv_i");fldChangeEUnits(b[0],a);spinnerBindGravity(b,a.to,alcEvent);b=$("#alc_expgrv_f");fldChangeEUnits(b[0],a);spinnerBindGravity(b,a.to,alcEvent);getById("alc_feunits").innerHTML=a.to};
calcScatter=function(a){for(var b in a){var c=$("#"+b.toLowerCase());if(c.length)if(c.hasClass("tunits"))rotateSetVal(c[0],TempUnits[a[b]],a[b]);else if(c.hasClass("butRotate"))rotateSetVal(c[0],a[b],a[b]);else if(c.hasClass("vunits")||c.hasClass("wunits")||c.hasClass("eunits"))unitselInit(c[0],a[b]);else c[void 0==c[0].value?"html":"val"](a[b]);else alert("col n/f = "+b)}};
calcClear=function(a,b,c){var e="undefined"==typeof $Recipe,f=e?bihDefaults.VOLUME:$Recipe.re_volume.val().toFloat(bihDefaults.VOLUME),g=e?bihDefaults.VUNITS:$Recipe.re_vunits.val(),i=e?bihDefaults.EUNITS:$Recipe.re_eunits.val(),h=e?0:$Recipe.re_expgrv.val().toFloat(),j=convertGravity(i,h,"SG")||1.048,l=convertGravity(i,h,"Plato")||12,h={};if("a"==a){if(!getById("alc_abv"))return!1;h.alc_expgrv_i=formatGravity(convertGravity("SG",j,i),i);h.alc_expgrv_f=formatGravity(convertGravity("SG",1+0.25*(j-
1),i),i);h.alc_eunits=i;h.alc_feunits=i;spinnerBindGravity($("#alc_expgrv_i"),h.alc_eunits,alcEvent);spinnerBindGravity($("#alc_expgrv_f"),h.alc_eunits,alcEvent);calcScatter(h);alcCalc()}else if("c"==a){if(!getById("carb_temp"))return!1;h.carb_style=e?"Beer":$Recipe.re_style.val()||"Beer";h.carb_co2range="2.25 - 2.75";h.carb_co2_f="2.25";h.carb_volume=f.toFixed(2);h.carb_vunits=g;h.carb_wunits=bihDefaults.HUNITS;h.carb_tunits=bihDefaults.TUNITS;h.carb_temp=formatTemp(convertTemp("F",68,h.carb_tunits),
h.carb_tunits);h.carb_co2_i=co2AtTemp(h.carb_temp,h.carb_tunits).toFixed(2);e||(g=tryJSON(RCP.qryRecipe.DATA[0].RE_PRIME),g.success&&$.extend(h,g.data));spinnerBindTemp($("#carb_temp"),h.carb_tunits,carbEvent);calcScatter(h);carbCalc()}else if("g"==a)h.gravity_sg=j.toFixed(3),h.gravity_plato=l.toFixed(1),h.gravity_tunits=bihDefaults.TUNITS,h.gravity_temp=formatTemp(convertTemp("F",68,h.gravity_tunits),h.gravity_tunits),calcScatter(h),gravityCalc(j);else if("i"==a)h.ibu_hop="Hop",h.ibu_aarange="3.0 - 7.0",
h.ibu_aau="5.0",h.ibu_volume=f.toFixed(2),h.ibu_boillen="0",h.ibu_util="0",h.ibu_expgrv=j.toFixed(3),h.ibu_vunits=g,h.ibu_wunits=bihDefaults.HUNITS,h.ibu_eunits=i,h.ibu_form=bihDefaults.HOPFORM,h.ibu_amount="0.00",h.ibu_ibu="0.0",spinnerBindGravity($("#ibu_expgrv"),h.ibu_eunits,ibuEvent),calcScatter(h);else if("k"==a){if(!getById("kettle_boillen"))return!1;e=(e?bihDefaults.BOILVOL:$Recipe.re_boilvol.val().toFloat(bihDefaults.BOILVOL))||f;h.kettle_volume_i=e.toFixed(2);h.kettle_volume_f=f.toFixed(2);
h.kettle_expgrv_f=formatGravity(convertGravity("SG",j,i),i);h.kettle_expgrv_i=formatGravity(1+h.kettle_volume_f*(h.kettle_expgrv_f-1)/h.kettle_volume_i,i);h.kettle_boillen="90";h.kettle_vunits=g;h.kettle_eunits=i;h.kettle_feunits=i;h.kettle_fvunits=g;h.kettle_brunits=g+" / Hour";spinnerBindGravity($("#kettle_expgrv_i"),h.kettle_eunits,kettleEvent);spinnerBindGravity($("#kettle_expgrv_f"),h.kettle_eunits,kettleEvent);calcScatter(h);kettleCalc()}else if("m"==a){if(!getById("mash_malt"))return!1;a=e?
bihDefaults.MUNITS:$Recipe.re_munits.val();b=e?toInt(convertWeight("Lbs",3.5*convertVolume(g,f,"Gallons"),a))/2:$Recipe.re_grnamt.val().toFloat(0);c=convertWeight(a,b,bihDefaults.MUNITS)*bihDefaults.RATIO;h.mash_vunits=g;h.mash_viunits=bihDefaults.VIUNITS;h.mash_munits=a;h.mash_tunits=bihDefaults.TUNITS;h.mash_malt=b.toFixed(2);h.mash_volume0=convertVolume(bihDefaults.VIUNITS,c,bihDefaults.VUNITS);h.mash_maltcap=bihDefaults.MALTCAP;h.mash_infuse0=c.toFixed(2);h.mash_duration0="60";h.mash_temp_f0=
formatTemp(convertTemp("F",154,h.mash_tunits),h.mash_tunits);h.mash_temp_i0=formatTemp(convertTemp("F",60,h.mash_tunits),h.mash_tunits);h.mash_temp_i1=formatTemp(convertTemp("F",154,h.mash_tunits),h.mash_tunits);h.mash_temp_f1=formatTemp(convertTemp("F",168,h.mash_tunits),h.mash_tunits);h.mash_temp_a1=formatTemp(convertTemp("F",212,h.mash_tunits),h.mash_tunits);h.mash_duration1="10";h.mash_ratio0=bihDefaults.RATIO.toFixed(2);e||(g=tryJSON(RCP.qryRecipe.DATA[0].RE_MASH),g.success&&$.extend(h,g.data));
mashRatioLabel(h.mash_viunits,h.mash_munits);calcScatter(h);mashDurationTotal();mashCalc("Infusion",0)}else if("t"==a)h.temp_f="68.0",h.temp_c="20.0",calcScatter(h);else{var h="v"==a?LitersConvert:GramsConvert,g=0,k;for(k in h)getById("un_"+a+g).value=b==k?c.toFixed(2):"0.00",getById("to_"+a+g).value="0.00",g++}};calcInit=function(){$("#divCalcTabs").tabs({cache:!0,spinner:"<span class=font7>Brewing&#8230;</span>"})};
carbCalc=function(){var a=selectedValue(getById("carb_wunits")),b=getById("carb_co2_f").value.toFloat(2.2),c=getById("carb_co2_i").value.toFloat(1),e=selectedValue(getById("carb_vunits")),f=getById("carb_volume").value.toFloat(0),g=selectedValue(getById("carb_primer")),a=co2SugarFromCO2(a,b-c,e,f,g);getById("carb_amount").value=a.toFixed(2);a=getById("carb_tunits").value;c=getById("carb_temp").value.toFloat(0);b=co2ForceCarbonation(a,c,"PSI",b);getById("carb_psi").value=b.toFixed(2)};
carbEvent=function(a){"change"==a.type&&(a.which=13);spinnerInc(a);if(!a.data.changed)return!0;var b=a.target.value.toFloat(0);if("carb_temp"==a.target.id)getById("carb_co2_i").value=co2AtTemp(b,$("#carb_tunits").val()).toFixed(2);else if("carb_amount"==a.target.id){var a=selectedValue(getById("carb_wunits")),b=getById("carb_amount").value.toFloat(),c=selectedValue(getById("carb_vunits")),e=getById("carb_volume").value.toFloat(),f=selectedValue(getById("carb_primer")),a=getById("carb_co2_i").value.toFloat(1)+
co2CO2FromSugar(a,b,c,e,f);getById("carb_co2_f").value=a.toFixed(2)}carbCalc()};
carbStylesAuto=function(){$("#carb_style").autocomplete(qryBJCPStyles.DATA,{width:200,matchContains:"word",formatItem:function(a){return a.ST_SUBSTYLE},formatMatch:function(a){return a.ST_SUBSTYLE},formatResult:function(a){return a.ST_SUBSTYLE}}).result(function(a,b){var c=(b.ST_CO2_MIN||2.25).toFixed(2),e=b.ST_CO2_MIN&&b.ST_CO2_MAX?" - "+b.ST_CO2_MAX.toFixed(2):"";getById("carb_co2range").value=c+e;getById("carb_co2_f").value=c})};
carbUnitsTemp=function(a){var b=$(a.data.fld),a=rotateTemp(a.target);spinnerBindTemp(b,a,carbEvent);var c=b.val().toFloat("F"==a?60:15.6),c="F"==a?convertTemp("C",c,"F"):convertTemp("F",c,"C");b.val(c.toFixed(1))};carbUnitsVolume=function(a){a=unitselFromTo(a);fldChangeVUnits(getById("carb_volume"),a)};carbUnitsWeight=function(a){a=unitselFromTo(a);fldChangeWUnits(getById("carb_amount"),a)};convertInit=function(){$("table.calculator caption button").show();rcp2calcVolume();rcp2calcWeight()};
gravityCalc=function(a){var b=$("#gravity_tunits").val(),c=getById("gravity_temp").value.toFloat(),a=correctGravity("SG",a,b,c,59);getById("hc_sg").value=a.toFixed(3);getById("hc_plato").value=convertGravity("SG",a,"Plato").toFixed(1)};
gravityEvent=function(a){"change"==a.type&&(a.which=13);spinnerInc(a);if(!a.data.changed)return!0;var b=a.target.value.toFloat(),c=0;"gravity_temp"==a.target.id?c=getById("gravity_sg").value.toFloat(1):"gravity_sg"==a.target.id?(c=b,getById("gravity_plato").value=convertGravity("SG",b,"Plato").toFixed(1)):(c=convertGravity("Plato",b,"SG"),getById("gravity_sg").value=c.toFixed(3));gravityCalc(c)};
gravityUnitsTemp=function(a){var b=$(a.data.fld),a=rotateTemp(a.target);spinnerBindTemp(b,a,gravityEvent);var c=b.val().toFloat("F"==a?60:15.6),c="F"==a?convertTemp("C",c,"F"):convertTemp("F",c,"C");b.val(c.toFixed(1))};
ibuCalc=function(a){var b=getById("ibu_eunits").value,c=selectedValue(getById("ibu_wunits")),e=selectedValue(getById("ibu_vunits")),f=getById("ibu_volume").value.toFloat(),g=getById("ibu_expgrv").value.toFloat(),i=getById("ibu_form").value,h=getById("ibu_aau").value.toFloat(),j=getById("ibu_amount").value.toFloat(),l=getById("ibu_boillen").value.toFloat(),k=ibuGetUtilization(i,l,"Boil");getById("ibu_util").value=k.toFixed(0);"Amount"==a?(a=getById("ibu_ibu").value.toFloat(),j=ibuAmountFromIBU(e,f,
b,g,c,a,h,i,l,"Boil",f),getById("ibu_amount").value=j.toFixed(2)):(a=ibuIBUFromAmount(e,f,b,g,c,j,h,i,l,"Boil",f),getById("ibu_ibu").value=a.toFixed(1))};ibuEvent=function(a){"change"==a.type&&(a.which=13);spinnerInc(a);if(!a.data.changed)return!0;a.target.value.toFloat();"ibu_ibu"==a.target.id?ibuCalc("Amount"):ibuCalc("IBU")};ibuHopForm=function(a){rotateSetVal(a,HopForm[a.innerHTML]||bihDefaults.HOPFORM);ibuCalc("IBU")};
ibuHopsAuto=function(){$("#ibu_hop").autocomplete(qryHops.DATA,{width:200,matchContains:"word",formatItem:function(a){return a.HP_HOP+", "+a.HP_GROWN},formatMatch:function(a){return a.HP_HOP+", "+a.HP_GROWN},formatResult:function(a){return a.HP_HOP}}).result(function(a,b){var c=(b.HP_AALOW||5).toFixed(1),e=b.HP_AALOW&&b.HP_AAHIGH?" - "+b.HP_AAHIGH.toFixed(1):"";getById("ibu_aarange").value=c+e;getById("ibu_aau").value=c})};
ibuUnitsGravity=function(a){var a=unitbtnFromTo(a,GravityUnits),b=$("#ibu_expgrv");fldChangeEUnits(b[0],a);spinnerBindGravity(b,a.to,ibuEvent)};ibuUnitsVolume=function(a){a=unitselFromTo(a);fldChangeVUnits(getById("ibu_volume"),a)};ibuUnitsWeight=function(a){a=unitselFromTo(a);fldChangeWUnits(getById("ibu_amount"),a)};
kettleCalc=function(a){var a=a||"",b=getById("kettle_eunits").value,c=getById("kettle_volume_i"),e=getById("kettle_volume_f"),f=getById("kettle_expgrv_i"),g=getById("kettle_expgrv_f"),i=getById("kettle_boillen"),c=c.value.toFloat(),h=e.value.toFloat(),f=convertGravity(b,f.value,"SG"),j=convertGravity(b,g.value,"SG"),i=i.value.toFloat();"kettle_expgrv_f"==a?h=c*(f-1)/(j-1):a.starts("kettle_boilpct")?h=c-c*val/100/60*i:a.starts("kettle_boilrate")&&(h=c-val/60*i);a=0==i?0:60*((c-h)/i);i=100*(a/c);g.value=
formatGravity(convertGravity("SG",1+c*(f-1)/h,b),b);e.value=h.toFixed(2);getById("kettle_boilrate").value=a.toFixed(2);getById("kettle_boilpct").value=i.toFixed(2)};kettleEvent=function(a){"change"==a.type&&(a.which=13);spinnerInc(a);if(!a.data.changed)return!0;kettleCalc(a.target.id)};
kettleUnitsGravity=function(a){var a=unitbtnFromTo(a,GravityUnits),b=$("#kettle_expgrv_i");fldChangeEUnits(b[0],a);spinnerBindGravity(b,a.to,kettleEvent);b=$("#kettle_expgrv_f");fldChangeEUnits(b[0],a);spinnerBindGravity(b,a.to,kettleEvent);getById("kettle_feunits").innerHTML=a.to};
kettleUnitsVolume=function(a){a=unitselFromTo(a);fldChangeVUnits(getById("kettle_volume_i"),a);fldChangeVUnits(getById("kettle_volume_f"),a);fldChangeVUnits(getById("kettle_boilrate"),a);getById("kettle_fvunits").innerHTML=a.to;getById("kettle_brunits").innerHTML=a.to+" / Hour"};
mashCalc=function(a,b){for(var a=a||"",b=b||0,c=getById("mash_infuse_f"),e=0,f=0,g=mashUnits(),i=getById("mash_maltcap").value.toFloat(0.4),h=getById("mash_malt").value.toFloat(),j=convertVolume(g.vunits,getById("mash_volume0").value.toFloat(),g.viunits),l=$("#mash_steps_rows")[0].rows.length,k=b;k<=l;k++){var o=getById("mash_infuse"+k),q=getById("mash_decoct"+k),p=getById("mash_temp_a"+k),n=getById("mash_temp_f"+k).value.toFloat(),s=getById("mash_temp_i"+k).value.toFloat(n),r=p.value.toFloat(n),
m=o.value.toFloat(),t=q?q.value.toFloat():0;0==k?(m=j,volume=0):(e=mashInfusionTotal(k),volume=j+e,f=getById("mash_steptype"+k).selectedIndex);"Infusion"==a?(r=mashInfusionTemp(g.viunits,volume,m,g.munits,h,s,n,i),p.value=formatTemp(r,g.tunits),0!=k&&(t=mashDecoctionWeight(g.viunits,volume,g.munits,h,r,s,n,i),q.value=t.toFixed(2))):"Decoction"==a?(r=mashDecoctionTemp(g.viunits,volume,g.munits,h,t,s,n,i),m=mashInfusionVolume(g.viunits,volume,g.munits,h,r,s,n,i),p.value=formatTemp(r,g.tunits),o.value=
m.toFixed(2)):(m=0==f?mashInfusionVolume(g.viunits,volume,g.munits,h,r,s,n,i):0,o.value=m.toFixed(2),0!=k&&(t=mashDecoctionWeight(g.viunits,volume,g.munits,h,r,s,n,i),q.value=t.toFixed(2)));o=(volume+m)/h;getById("mash_volume"+k).value=convertVolume(g.viunits,volume+m,g.vunits).toFixed(2);getById("mash_ratio"+k).value=o.toFixed(2);a=""}c.value=(m+e).toFixed(2)};
mashDurationTotal=function(){var a=0;$("#mash_steps tbody input.duration").each(function(){a+=this.value.toFloat()});getById("mash_length").value=a.toFixed(0)};
mashEvent=function(a){"change"==a.type&&(a.which=13);spinnerInc(a);if(!a.data.changed)return!0;var b=a.target.id.right(1).toInt(),c=mashUnits();if(a.target.id.starts("mash_duration"))return mashDurationTotal();"mash_infuse0"==a.target.id&&(getById("mash_volume0").value=convertVolume(c.viunits,a.target.value.toFloat(),c.vunits).toFixed(2));"mash_volume0"==a.target.id&&(getById("mash_infuse0").value=convertVolume(c.vunits,a.target.value.toFloat(),c.viunits).toFixed(2));if("mash_ratio0"==a.target.id){var e=
getById("mash_malt").value.toFloat()*a.target.value.toFloat();getById("mash_infuse0").value=e.toFixed(2);getById("mash_volume0").value=convertVolume(c.viunits,e,c.vunits).toFixed(2)}0==b&&"mash_temp_a0"!=a.target.id?mashCalc("Infusion",b):a.target.id.starts("mash_infuse")?mashCalc("Infusion",b):a.target.id.starts("mash_decoct")?mashCalc("Decoction",b):mashCalc("Both",b)};
mashInfusionTotal=function(a){var b=0;$("#mash_steps input.units_vi").slice(1,a).each(function(){getById("mash_steptype"+a).selectedIndex||(b+=this.value.toFloat())});return b};
mashProgram=function(a){$("#mash_steps_rows").empty();var b=mashUnits(),c=a[0].ratio,c=getById("mash_malt").value.toFloat()*c,e=formatTemp(convertTemp("C",a[0].f,b.tunits),b.tunits),f=formatTemp(convertTemp("F",210,b.tunits),b.tunits),g=0;getById("mash_temp_f0").value=e;getById("mash_infuse0").value=c.toFixed(2);getById("mash_volume0").value=convertVolume(b.viunits,c,b.vunits);mashCalc("Infusion",0);for(step in a)0!=step&&(g=e,e=formatTemp(convertTemp("C",a[step].f,b.tunits),b.tunits),mashStepAdd(a[step].t,
e,g,f))};mashRatioLabel=function(a,b){a||(a=getById("mash_viunits").value);b||(b=getById("mash_munits").value);$("#mash_steps .mash_ratio_units").html(a+" / "+b)};
mashStepAdd=function(a,b,c,e){var f=mashUnits(),g=$("#mash_steps_rows"),i=g[0].rows.length+1,h=$("#mash_stepAdd tr:first").clone().data("row",i);$("#btnMashStepDelete").replaceWith("&nbsp;");h.find("input, select").each(function(){this.id=this.name+i});spinnerBind(h.find("input.units_m, input.units_vi"),incAmt,mashEvent);spinnerBindTemp(h.find("input.units_t"),f.tunits,mashEvent);g.append(h);f=i-1;g=getById("mash_temp_f"+f).value;getById("mash_temp_f"+i).value=b||g;getById("mash_temp_i"+i).value=
c||g;getById("mash_temp_a"+i).value=e||getById("mash_temp_a"+f).value;b=getById("mash_steptype"+i);b.selectedIndex=a?a:getById("mash_steptype"+f).selectedIndex;mashStepTypeShow(b.selectedIndex,i);mashCalc("Both",i)};mashStepDelete=function(){var a=$("#btnMashStepDelete"),b=$("#mash_steps_rows");b.find("tr:last").remove();b.find("tr:last").find(".icon").html(a)};mashStepType=function(a){var b=a.id.right(1).toInt();mashStepTypeShow(a.selectedIndex,b);mashCalc("Both",b)};
mashStepTypeShow=function(a,b){0!=a?$("#mash_infuse"+b).fadeOut():$("#mash_infuse"+b).fadeIn();1!=a?$("#mash_decoct"+b).fadeOut():$("#mash_decoct"+b).fadeIn();2==a?$("#mash_temp_a"+b).fadeOut():$("#mash_temp_a"+b).fadeIn()};mashUnits=function(){var a={};a.tunits=getById("mash_tunits").value;a.munits=getById("mash_munits").value;a.vunits=getById("mash_vunits").value;a.viunits=getById("mash_viunits").value;return a};
mashUnitsTemp=function(a){var b=a.target.value,c=rotateTemp(a.target);spinnerBindTemp($("#tabMash input.units_t"),c,mashEvent).each(function(){this.value=formatTemp(convertTemp(b,this.value.toFloat(),c),c)})};mashUnitsVolume=function(a){var b=unitselFromTo(a);mashUnits();"mash_vunits"==a.id?$("#tabMash input.units_v").each(function(){fldChangeVUnits(this,b)}):($("#tabMash input.units_vi").each(function(){fldChangeVUnits(this,b)}),mashRatioLabel(b.to,!1))};
mashUnitsWeight=function(a){var b=unitselFromTo(a);$("#tabMash input.units_m").each(function(){fldChangeWUnits(this,b)});mashRatioLabel(!1,b.to)};tempEvent=function(a){"change"==a.type&&(a.which=13);spinnerInc(a);if(!a.data.changed)return!0;var b=a.target.value.toFloat();"temp_f"==a.target.id?getById("temp_c").value=convertTemp("F",b,"C").toFixed(1):getById("temp_f").value=convertTemp("C",b,"F").toFixed(1)};
ucalcBuild=function(a,b,c){var a=$("#"+a+" tbody"),e=a.find("tr"),f=0,g;for(g in c){var i=e.clone();i.find("td.unitlabel").append(g);var h=$("<input type=text maxlength=7 class=decimal value=0.00>").attr("id","un_"+b+f).addClass("unit");i.find("td.unitinput").append(h);h=$("<input type=text class=decimal readonly=readonly value=0.00>").attr("id","to_"+b+f).addClass("unittotal");1==c[g]&&h.addClass("convert"+g);i.find("td.unittotal").append(h);a.append(i);f+=1}e.remove();spinnerBind(a,$.extend({calc:b},
incAmt),ucalcEvent)};ucalcCalc=function(a){var b="v"==a?LitersConvert:GramsConvert,c=0,e=0,f;for(f in b){var g=getById("un_"+a+c),e=e+g.value.toFloat()*b[f];c++}c=0;for(f in b)getById("to_"+a+c).value=(e/b[f]).toFixed(2),c++};ucalcEvent=function(a){"change"==a.type&&(a.which=13);spinnerInc(a);if(!a.data.changed)return!0;ucalcCalc(a.data.calc)};
treeFilterBrewLog=function(a){var b=0,c=0,e=0,f=0,g=0,i=0,h=function(a,h){if(!h)return!1;b++;c+=convertVolume(a.RE_VUNITS,a.RE_VOLUME,bihDefaults.VUNITS);e+=convertGravity(a.RE_EUNITS,a.RE_EXPGRV,bihDefaults.EUNITS);f+=a.RE_EXPSRM;i+=a.RE_EXPIBU;g+=a.RE_EFF;return!0};treeFilterData(a,{caption:"Brew Log",rowid:"#bl_rowid",val:a.data.key},qryBrewLog,{trMonth:{hit:function(a,b){var c=new Date(a.RE_BREWED);return h(a,c.getFullYear()==b.year&&c.getMonth()==b.mon)},val:function(a){var b=a.val.split("!")[1].split("_");
a.val={year:parseInt(b[0],10).toString(),mon:parseInt(b[1],10).toString()};a.val.d=parseDate(a.val.mon+"/01/"+a.val.year,"mm/dd/yyyy");a.caption+=" for "+a.val.d.month+" "+a.val.year;a.val.mon--}},trYear:{hit:function(a,b){return h(a,(new Date(a.RE_BREWED)).getFullYear()==b.year)},val:function(a){a.val={year:parseInt(a.val.split("!")[1],10).toString()};a.caption+=" for "+a.val.year}},RE_NAME:{hit:function(a,b){return h(a,a.RE_NAME==b)}},RE_STYLE:{hit:function(a,b){return h(a,a.RE_STYLE==b)}}});$("#bl_cnt").html(b+
addS(" record",b));$("#bl_total").html(c.toFixed(2)+" "+bihDefaults.VUNITS);$("#bl_avgvolume").html((c/b).toFixed(2));$("#bl_avggrv").html((e/b).toFixed(3));$("#bl_avgibu").html((i/b).toFixed(0));$("#bl_avgsrm").html((f/b).toFixed(1));$("#bl_avgeff").html((g/b).toFixed(0))};
treeFilterData=function(a,b,c,e){var f=c.DATA.length,g=0;a.data.isRoot?b.nots=treeNots(a.tree):a.data.isFolder?b.nots=treeNots(a.tree,a.data.key):(b.field=a.data.key.split("!")[0],"object"==typeof e&&e[b.field]&&e[b.field].val?e[b.field].val(b):(b.val=a.data.title,b.caption+=" for "+b.val));for(var i=0;i<f;i++){var h=!0,h=c.DATA[i],h=a.data.isRoot||a.data.isFolder?!treeNodeInNots(h,b.nots):"object"==typeof e&&e[b.field]?e[b.field].hit(h,b.val):h[b.field]==b.val;treeFilterRow($(b.rowid+i),h)&&g++}b.caption+=
treeRowCnt(f,g);$.tablesorter.applyWidget($expTab[0]);$expCap.html(b.caption)};treeFilterGrains=function(a){treeFilterData(a,{caption:"Grains",rowid:"#gr_rowid",val:a.data.title},qryGrains,{GR_LVB:{hit:function(a,c){return a.GR_LVB>=c[0]&&a.GR_LVB<=c[1]},val:function(a){a.caption+=" for SRM "+a.val;a.val=treeRange(a.val,"5000")}}})};
treeFilterHops=function(a){treeFilterData(a,{caption:"Hops",rowid:"#hp_rowid",val:a.data.title},qryHops,{HP_AAU:{hit:function(a,c){var e=(a.HP_AALOW+a.HP_AAHIGH)/2;return e>=c[0]&&e<=c[1]},val:function(a){a.caption+=" for AAU "+a.val;a.val=treeRange(a.val,"50")}},HP_USE:{hit:function(a,c){return"Bittering"==c?0!=a.HP_BITTER:"Aroma"==c?0!=a.HP_AROMA:0!=a.HP_DRY}}})};treeFilterMisc=function(a){treeFilterData(a,{caption:"Miscellaneous Ingredients",rowid:"#mi_rowid",val:a.data.title},qryMisc)};
treeFilterRow=function(a,b){b?a.show():a.hide();return b};treeFilterYeast=function(a){treeFilterData(a,{caption:"Yeast Strains",rowid:"#ye_rowid",val:a.data.title},qryYeast)};treeInit=function(){$divExpAcc=$("#divExpAcc").accordion({fillSpace:!0,changestart:function(a,b){treeLoad(b.newHeader.data("src"))},animated:!1});treeLoad(bihLoggedIn?"BrewLog":"Grains");$divExpSave=$("#divExpSave")};
treeLazyData=function(a,b){return{url:bihPath.cfc+"/proxy.cfc",data:{method:"call",args:JSON.stringify({meth:a+".GetExplorerNodes",data:{root:b||"source"}})},postProcess:treeLazyLoaded}};treeLazyLoaded=function(a){if(bihLoggedIn){var b=$divTree.data("which");"BrewLog"!=b&&($divTree.append($divExpSave.hide().fadeIn()),treeSetFiltered(a,filterData[b]))}return a};
treeLoad=function(a){a=a||"BrewLog";treeFilter=window["treeFilter"+a];$("#divExpRight").find(">div").hide();var b=$("#divExp"+a).show();$divTree=$("#divTree"+a);$divTree.data("loaded")?($expCap=$("#divCaption"+a),$expTab=$("#tabScrollBody"+a),"BrewLog"!=a&&$divTree.append($divExpSave.hide().fadeIn())):($divTree.data("loaded",!0).data("which",a),$divTree.html("<ul id='tree"+a+"'></ul>"),nodeURL="BrewLog"==a?"Recipe":a,$divTree.dynatree({idPrefix:"tree"+a,cookieId:"tree"+a,checkbox:!0,selectMode:3,
minExpandLevel:2,autoCollapse:!1,fx:{height:"toggle",duration:800},initAjax:treeLazyData(nodeURL),onLazyRead:function(a){a.appendAjax(treeLazyData(nodeURL,a.data.key))},onActivate:treeFilter,onSelect:treeSelect,onDblClick:function(a){a.toggleSelect()},onKeydown:function(a,b){if(32==b.which)return a.toggleSelect(),!1}}),pageURL="e."+a+".cfm",b.load(pageURL,function(){$expTab=$("#tabScrollBody"+a);$expTab.length&&($expCap=$("#divCaption"+a))}))};
treeNodeInNots=function(a,b){for(var c in b)if(-1!=$.inArray(a[c],b[c]))return!0;return!1};treeNots=function(a,b){var b=b||!1,c={};$.each(a.getSelectedNodes(),function(){var a=this.data.key.split("!");if(!b||b==a[0])void 0==c[a[0]]&&(c[a[0]]=[]),c[a[0]].push(a[1])});return c};treeRange=function(a,b){a=a.split("-");a[0]=parseInt(a[0]);a[1]=parseInt(a[1]||b);return a};treeRowCnt=function(a,b){var c="<span class=rowcnt>";a!=b&&(c+="Filtered "+b+" of ");return c+(a+addS(" record",a)+"</span>")};
treeSelect=function(a,b){a&&b.data.isFolder&&(b.toggleSelect(!1),treeFilter(b));b.getParent().isActive()?treeFilter(b.getParent()):b.getParent().getParent().isActive()&&treeFilter(b.getParent().getParent())};treeSetFiltered=function(a,b){if(void 0!=a.length)for(var c=0;c<a.length;c++)if(void 0==a[c].children){var e=a[c].key.split("!")[0];if(void 0==b[e])break;-1!=$.inArray(a[c].title,b[e])&&(a[c].select=!0)}else treeSetFiltered(a[c].children,b)};
recipeOpen=function(a){a="Add"==a.title?-1:qryBrewLog.DATA[$(a).parents("tr").data("rowid")||0].RE_REID;window.location.href="p.recipe.cfm?reid="+a};treeSave=function(){var a=$divTree.data("which"),b=treeNots($divTree.dynatree("getTree"));filterData[a]=b;remoteCall("UserPrefs.Process",{set:"filter"+a,value:b},treeCallBack)};treeCallBack=function(a){a.SUCCESS?"Set"==a.DATA.METHOD&&showStatusWindow("Filter Saved"):cbErrors(a)};
grainsClickRow=function(){var a=$(this).data("rowid")||0,b=$("#infoGrains");grainsScatter(qryGrains.DATA[a],b)};
grainsInit=function(){var a=$("#tabGrains");queryMakeHashable(qryGrains);for(var b=a.find("tbody"),c=b.find("tr"),e=window.metaRecipe&&filterData.Grains,f=0;f<qryGrains.DATA.length;f++){var g=qryGrains.DATA[f];if(e){var i=!1,h;for(h in e)if(i=-1!=$.inArray(g[h],e[h]))break;if(i)continue}i=c.clone();grainsScatter(g,i);i.attr("id","gr_rowid"+f);i.data("rowid",f);b.append(i)}c.remove();a.tablescroller({id:"Grains",height:330,sort:!0,print:!1,borderWidth:1,borderColor:"#979F97"});b.find("tr").click(grainsClickRow);
b.find("tr:first").click()};
grainsScatter=function(a,b){b.find(".gr_type").html(a.GR_TYPE);b.find(".gr_maltster").html(a.GR_MALTSTER);b.find(".gr_country").find("img").attr("class","flagSM flag"+a.GR_COUNTRY).attr("title",a.GR_COUNTRY);b.find(".gr_country").find("span").html(a.GR_COUNTRY);b.find(".gr_lvb").html(a.GR_LVB);b.find(".gr_sgc").html(a.GR_SGC.toFixed(3));b.find(".gr_mash").find("img").attr("class","bih-icon bih-icon-checked"+iif(a.GR_MASH,"1","0"));b.find(".gr_cat").html(a.GR_CAT);"infoGrains"==b.attr("id")?(b.find(".gr_info").html(a.GR_INFO),
rowHighlight(b,"gr_rowid",a._ROWID)):b.find("div.gr_info").html(a.GR_INFO.left(50))};grainsScrollTo=function(){var a=$("#tabScrollBodyGrains").find("tbody").find("#gr_rowid"+selectedRow.rowid);a.length&&$("#divScrollBodyGrains").scrollTo(a,800)};String.prototype.left=function(a){return left(this,a)};String.prototype.right=function(a){return right(this,a)};String.prototype.starts=function(a){return starts(this,a)};String.prototype.toInt=function(a){return toInt(this,a)};
String.prototype.toFloat=function(a){return toFloat(this,a)};String.prototype.pipeCRLF=function(a){return pipeCRLF(this,a)};addS=function(a,b,c){c||(c="s");return 1==b?a:a+c};cbErrors=function(a){var b="";$.each(a.ERRORS,function(a,e){b+=e.ERROR+"\n"});showStatusWindow(b,0,!0)};pipeCRLF=function(a,b){return b?a.toString().replace(/(\r\n|[\r\n])/g,"|"):a.toString().replace(/\|/g,"\n")};datemaskStrip=function(a){$(a).removeClass("hasmask")};
datemaskToggle=function(a){isEmpty(a)?$(a).addClass("hasmask"):datemaskStrip(a)};focusSelect=function(a,b){b?(a.focus(),("text"==a.type||"textarea"==a.type)&&a.select()):(tmpfld=a,setTimeout("focusSelect(tmpfld, 1)",0))};
getBrowser=function(){var a=navigator.userAgent,b=$.browser.version.split(".")[0],c="";$.browser.msie?c="MSIE "+b:/Chrome/i.test(a)?(b=a.substring(a.indexOf("Chrome/")+7).split(".")[0],c="Chrome "+b):$.browser.opera?c="Opera "+b:$.browser.safari?(b=a.substring(a.indexOf("Version/")+8).split(".")[0],c="Safari "+b):/Firefox/i.test(a)?(b=a.substring(a.indexOf("Firefox/")+8).split(".")[0],c="Firefox "+b):/BlackBerry/i.test(a)?(b=a.substring(a.indexOf("/")+1).split(".")[0],c="BlackBerry "+b):/NetFront/i.test(a)&&
(b=a.substring(a.indexOf("NetFront/")+9).split(".")[0],c="NetFront "+b);""==c?c="?"+a:/iPhone/i.test(a)?c="iPhone "+c:/Android/i.test(a)&&(c="Android "+c);return c};getCheckImg=function(a,b){a=parseInt(a)?"1":"0";return"<img title='"+b+"' src='"+bihPath.img+"/trans.gif' class='bih-icon bih-icon-checked"+a+"' />"};getById=function(a){return document.getElementById(a)};getFlagImg=function(a){return"<img class='flagSM flag"+a+"' src='"+bihPath.img+"/trans.gif' />"};
getPopOutImg=function(a){return"<img onclick=popOut('"+a+"') class='bih-icon bih-icon-popout' src='"+bihPath.img+"/trans.gif' />"};iif=function(a,b,c){return a?b:c};inQs=function(a){return"'"+a+"'"};isDefined=function(a){return"undefined"!=typeof window[a]};isEmpty=function(a,b){var c=0==trim(a).length;c&&b&&(alert(b),"object"==typeof a&&focusSelect(a));return c};isField=function(a){return"object"==typeof a};
isLenValid=function(a,b,c){var e=trim(a);c||(c="Field");return e.length>b?(window.alert(c+" cannot be longer than "+b+" characters."),"object"==typeof a&&focusSelect(a),!1):!0};isNotEmail=function(a,b){"object"==typeof a&&(a.value=a.value.toLowerCase());return isNotREMatch(a,/^['_a-z0-9-]+(\.['_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*\.(([a-z]{2,3})|(aero|coop|info|museum|name))$/,b)};isNotEqual=function(a,b,c){(a=a!=b)&&c&&alert(c);return a};
isNotREMatch=function(a,b,c){var e=trim(a);if((b=!b.test(e))&&c)alert(c),"object"==typeof a&&focusSelect(a);return b};isNotSelected=function(a,b){var c=0==a.options[a.selectedIndex].value;c&&(alert(b),focusSelect(a));return c};
isURL=function(a,b){var c=trim(a);if(!c.length)return!0;b&&(b="'"+c+"' is not a valid URL.");c.starts("http")||(c="http://".concat(c));var e=/^(https?):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(c);!e&&
b&&alert(b);isField(a)&&(e?a.value=c:focusselect(a));return e};isZero=function(a,b){var c=trim(a);if((c=0==toFloatMin(c,0))&&b)alert(b),"object"==typeof a&&focusSelect(a);return c};jsDateFormat=function(a,b){b||(b="mm/dd/yyyy");var c=""+a.getFullYear(),e=""+(a.getMonth()+1),f=""+a.getDate(),g=0<=b.indexOf("-")?"-":"/",i=b.split(g);i[0]&&(newDate=nextDatePart(i[0],e,f,c));i[1]&&(newDate=newDate.concat(g,nextDatePart(i[1],e,f,c)));i[2]&&(newDate=newDate.concat(g,nextDatePart(i[2],e,f,c)));return newDate};
left=function(a,b){return 0>=b?"":b>(""+a).length?""+a:(""+a).substring(0,b)};liveHover=function(){$(document).on("mouseover mouseout",".liveHover",{},function(a){"mouseover"==a.type?$(this).addClass("ui-state-hover"):"mouseout"==a.type&&$(this).removeClass("ui-state-hover")})};loadFieldToRow=function(a,b){b.DATA[a.name.toUpperCase()]=a.value};
loadFormToRow=function(a,b,c){"undefined"==typeof c&&(c="");for(var e in b)(fld=a[e.toLowerCase()+c.toString()])&&(b[e]=/select/.test(fld.type)?-1==fld.selectedIndex?0:fld.options[fld.selectedIndex].value:"checkbox"==fld.type?fld.checked?1:0:"button"==fld.type?fld.value:/currency/.test(fld.className)?parseFloat(cleannumber(fld.value)):/decimal/.test(fld.className)?parseFloat(fld.value):/integer/.test(fld.className)?parseInt(fld.value):fld.value)};
loadRowToForm=function(a,b,c,e){"undefined"==typeof e&&(e="");for(var f in a){var g=b[f.toLowerCase()+e];if(g){var i=g.length;g.idx=e;/bihDateMM/.test(g.className)&&queryFixDate(a,f);if("select-multiple"==g.type)for(var h=a[f],h=h.toString().split(","),j=0;j<i;j++)for(var l=0;l<h.length;l++)g.options[j].value==h[l]&&(g.options[j].selected=!0);else if(/select/.test(g.type))selectValue(g,a[f]),g.oldvalue=a[f];else if("checkbox"==g.type)g.checked=0!=a[f];else if(i&&"radio"==g[0].type)for(j=0;j<i;j++)g[j].checked=
g[j].value==a[f];else"button"==g.type?(i=a[f],c&&"function"==typeof c[f][metaFormat]&&(i=c[f][metaFormat](i)),rotateSetVal(g,i,a[f])):"textarea"==g.type?(h=a[f]||"",g.value=h.toString().replace(RegExp("<br\\s*(/>|>)","ig"),String.fromCharCode(13))):(g.value=a[f],/currency/.test(g.className)?g.value=dollarFormat(a[f],!0):/date/.test(g.className)?a[f]&&(g.value=jsDateFormat(new Date(a[f]))):/decimal/.test(g.className)?(i=c?c[f][metaSize].toString().split(".")[1]:2,g.value=parseFloat(a[f]||0).toFixed(i)):
g.value=a[f])}}};ltrim=function(a,b){return a.replace(RegExp("^["+(b||"\\s")+"]+","g"),"")};nextDatePart=function(a,b,c,e){return a.match(/dd/gi)?zeroPad(c,2):a.match(/d/gi)?c:a.match(/yyyy/gi)?e:a.match(/yy/gi)?e.slice(2):a.match(/mmm/gi)?"JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC".substr(3*(b-1),3):a.match(/mon/gi)?"JanFebMarAprMayJunJulAugSepOctNovDec".substr(3*(b-1),3):a.match(/mm/gi)?zeroPad(b,2):a.match(/m/gi)?b:"??"};now=function(){return jsDateFormat(new Date)};
openURL=function(a){if(!isURL(a,!0))return!1;var b=isField(a),c=b?a.value:a;if(""==c)return showStatusWindow("Please enter a URL to open."),b&&focusselect(a),!1;popOut(c,"_blank")};
parseDate=function(a,b){b||(b=cfDateMask);var c={},e,f=/^([1-9]|0[1-9]|1[0-2])\/([1-9]|[0-9][0-9])\/(\d{2}|\d{4})$/,g=/^([1-9]|[0-9][0-9])\/([1-9]|0[1-9]|1[0-2])\/(\d{2}|\d{4})$/,i=a.replace(/-/g,"/").toUpperCase();if(e=i.match(/^([1-9]|[0-9][0-9])\/(JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)\/(\d{2}|\d{4})$/i))c.dd=parseInt(e[1],10),c.mon=e[2],c.mm="JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC".search(RegExp(c.mon,"i"))/3+1,c.yy=parseInt(e[3],10);else if("dd/mm/yyyy"==b){if(e=i.match(g))c.dd=parseInt(e[1],
10),c.mm=parseInt(e[2],10),c.yy=parseInt(e[3],10)}else if("mm/dd/yyyy"==b&&(e=i.match(f)))c.mm=parseInt(e[1],10),c.dd=parseInt(e[2],10),c.yy=parseInt(e[3],10);c.valid=c.yy?!0:!1;if(c.valid)if(c.month="January,February,March,April,May,June,July,August,September,October,November,December".split(",")[c.mm-1],100>c.yy&&(e=c.yy-((new Date).getFullYear()-2E3),c.yy+=20>e?2E3:1900),c.valid=32>c.dd&&0<c.dd,c.valid)switch(c.mm){case 2:c.valid=29>c.dd||29==c.dd&&0==c.yy%4;c.valid||(c.error="February 29th is not a valid day in the year "+
c.yy+".");break;case 4:case 6:case 9:case 11:c.valid=31>c.dd,c.valid||(c.error="The 31st is not a valid day in "+c.month+".")}else e="",0!=c.dd&&(e=3<c.dd&&21>c.dd?"th":"th,st,nd,rd,th,th,th,th,th,th".split(",")[c.dd%10]),c.error="The "+c.dd+e+" is not a valid day of the month.";else e=(new Date).getFullYear().toString(),c.error="dd/mm/yyyy"==b?"31/12/":"mm/dd/yyyy"==b?"12/31/":"31-DEC-",c.error="Date is not in the format '"+b+"'.\n\nFor example, '"+c.error+e+"' is December 31st "+e+".";c.valid&&
(c.mon="JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC".substr(3*(c.mm-1),3),c.date=new Date(c.yy,c.mm-1,c.dd),c.UTC=Date.UTC(c.yy,c.mm-1,c.dd),c.dd=zeroPad(c.dd,2),c.mm=zeroPad(c.mm,2),c.yy=""+c.yy,c.error="");return c};popOut=function(a,b,c,e){c||(c=1024);e||(e=768);b||(b="_blank");return window.open(a,b,"width="+c+",height="+e+",titlebar=0,toolbar=0,menubar=0,location=1,status=0,scrollbars=1,resizable=1")};
queryAddRow=function(a){for(var b={},c=a.DATA.length,e=0;e<a.COLUMNS.length;e++)b[a.COLUMNS[e]]="";a.DATA[c]=b;return c};queryFixDate=function(a,b){val=a[b];null==val||""==val?a[b]="":(d=new Date(val),isNaN(d.getTime())||(a[b]=jsDateFormat(d,cfDateMask)))};
queryIsFormEqualRow=function(a,b,c,e){var f;"undefined"==typeof c&&(c="");for(var g in b)if(b.hasOwnProperty(g)&&!(e&&-1!=$.inArray(g.toLowerCase(),e))&&(f=a[g.toLowerCase()+c])&&!f.disabled)if(/select/.test(f.type)){if(b[g]!=f.options[f.selectedIndex].value)return!1}else if("checkbox"==f.type){if(b[g]!=f.checked)return!1}else if("button"==f.type){if((b[g]||"")!=f.value)return!1}else if(/currency/.test(f.className)){if(dollarFormat(b[g]||0,!1)!=dollarFormat(f.value,!1))return!1}else if(/date/.test(f.className)){if(jsDateFormat(new Date(b[g]))!=
f.value)return!1}else if(/decimal/.test(f.className)){if((b[g]||0)!=f.value)return!1}else if((null==b[g]?"":b[g])!=f.value)return!1;return!0};queryMakeHashable=function(a){if(a.DATA.length&&void 0==a.DATA[0]._ROWID)for(var b=RegExp("^[\\s]+","g"),c=0;c<a.DATA.length;c++){var e={_DELETED:!1};e._ROWID=c;for(var f=0;f<a.COLUMNS.length;f++){var g=a.DATA[c][f];null!=g&&g.length&&(g=g.replace(b,""));e[a.COLUMNS[f]]=g}a.DATA[c]=e}};
querySearch=function(a,b,c){if(!a.DATA.length||void 0==a.DATA[0][b])return-1;for(var e=0;e<a.DATA.length;e++)if(a.DATA[e][b]==c)return e;return-1};querySearchIdx=function(a,b,c,e,f,g){for(var i=e.left(1),h=f&&g&&""!=g,j=-1,l=-1,k=-1,o=-1,q=-1,b=b[i]||0;b<a.DATA.length;b++){var p=a.DATA[b][c];if(p.left(1)==i)if(l=b,p==e)if(j=b,h){if(a.DATA[b][f]==g)break}else break;else{if(-1!=j)break;p.starts(e)?q=b:p.left(5)==e.left(5)?o=b:p.left(3)==e.left(3)&&(k=b)}else if(-1!=l){j=-1!=q?q:-1!=o?o:-1!=k?k:l;break}}return j};
remoteCall=function(a,b,c,e){var f=function(a){c&&c(a)};$.ajax({async:e||!1,type:"post",data:{method:"call",args:JSON.stringify({meth:a,data:b})},dataType:"JSON",url:bihPath.cfc+"/proxy.cfc",success:f,error:f,cache:!1})};right=function(a,b){a=""+a;return 0>=b?"":b>a.length?a:a.substring(a.length,a.length-b)};rowHighlight=function(a,b,c){var e=a.data("rowid");""!=e&&$("#"+b+e).toggleClass("blue");a.data("rowid",c);$("#"+b+c).toggleClass("blue")};
rtrim=function(a,b){return a.replace(RegExp("["+(b||"\\s")+"]+$","g"),"")};selectedOption=function(a){return a.options[a.selectedIndex].text};selectedValue=function(a){return a.options[a.selectedIndex].value};selectOption=function(a,b){for(var c=0;c<a.length;c++)if(a.options[c].text==b)return a.options[c].selected=!0;return!1};selectValue=function(a,b){for(var c=0;c<a.length;c++)if(a.options[c].value==b)return a.options[c].selected=!0;return!1};
rotateSetVal=function(a,b,c){a.innerHTML=b;a.value=c||b;return c||b};setTD=function(a,b,c,e){var f=a.find("td."+c);f.length||(f=$("<td>").addClass(c+(e?" "+e:"")),a.append(f));return f.html(b)};setWaitImg=function(a,b){var c=document.getElementById(a);c&&(b?"run"==b?b="ani_ajaxrun.gif":"error"==b?b="ani_ajaxerror.gif":"done"==b&&(setTimeout('setWaitImg("'+a+'")',5E3),b="ani_ajaxdone.gif"):b="icon_blank.png",c.src="./images/"+b)};
showStatusWindow=function(a,b,c){var e=$("#divStatus");b||(b=3E3);e.length||(e=$("<div id=divStatus class='statusWindow ui-state-default'></div>").appendTo($("body")),e.click(function(){$(this).stop(!0,!0).fadeOut(600)}));e.stop(!0,!0);e.html(a);c?(e.append("<div class='statusWindowCloseBtn ui-icon ui-icon-close'></div>"),e.addClass("ui-state-error"),e.fadeIn(b)):(e.removeClass("ui-state-error"),-1==b?e.show():e.fadeIn(750).delay(b).fadeOut(1500));return e};
spinnerInc=function(a){var b=a.shiftKey?a.data.maxInc:a.ctrlKey||a.metaKey?a.data.minInc:a.data.inc,c=parseFloat(a.target.value)||0;a.data.changed=!1;a.data.minVal=a.data.minVal||0;if(38==a.which){if(c>=a.data.maxVal)return!1;c+=b}else if(40==a.which){if(c<=a.data.minVal)return!1;c-=b}else if(13!=a.which)return!0;c=Math.max(Math.min(c,a.data.maxVal),a.data.minVal);a.target.value=c.toFixed(a.data.decimals);a.target.select();return a.data.changed=!0};
starts=function(a,b){return left(a,(""+b).length)==b};tbodyHide=function(a){$btn=$(a);a=$btn.parents("table").find("tbody");a.is(":visible")?(a.fadeOut(800),$btn.find(".ui-icon").removeClass("ui-icon-arrowthickstop-1-n").addClass("ui-icon-arrowthickstop-1-s")):(a.fadeIn(1E3),$btn.find(".ui-icon").removeClass("ui-icon-arrowthickstop-1-s").addClass("ui-icon-arrowthickstop-1-n"))};
textareaMaxLen=function(a,b){var c=$("#"+a.name+"_len");if(!c.length)return!0;if(b)return c.fadeOut(500),!0;c.show();if(a.readOnly)return c.html("read only"),c.css("background-color","#FFFFAA"),!0;var e=a.value.length,f=parseInt($(a).data("maxlen")),e=Math.max(f-a.value.length,0);c.html(e.toString());if(!e)return a.value=a.value.substring(0,f),c.css("background-color","#FFAAAA"),!1;c.css("background-color","");return!0};toFloat=function(a,b){return void 0==a||isNaN(parseFloat(a))?b||0:parseFloat(a)};
toFloatMax=function(a,b){return void 0==a||isNaN(parseFloat(a))?b:Math.min(parseFloat(a),b)};toFloatMin=function(a,b){return void 0==a||isNaN(parseFloat(a))?b:Math.max(parseFloat(a),b)};toInt=function(a,b){return void 0==a||isNaN(parseInt(a))?b||0:parseInt(a)};toIntMax=function(a,b){return void 0==a||isNaN(parseInt(a))?b:Math.min(parseInt(a),b)};toIntMin=function(a,b){return void 0==a||isNaN(parseInt(a))?b:Math.max(parseInt(a),b)};
trapKeypress=function(a,b){var c;if(window.event)c=window.event.keyCode;else if(c=a.which,0==c||8==c||9==c)return;return b.test(String.fromCharCode(c))};trim=function(a,b){var c="object"==typeof a;str=c?a.value:a;str=ltrim(rtrim(str+"",b),b);c&&(a.value=str);return str};tryJSON=function(a){var b={success:!0};try{b.data=$.parseJSON(a)}catch(c){b.success=!1}return b};
validateDate=function(a,b,c){var e=trim(a);if(!e.length)return!0;var f="object"==typeof a;b||(b=!1);c||(c=cfDateMask);e=parseDate(e,cfDateMask);e.valid&&(1900>e.yy?(e.error="For years prior to 1900, please contact the Help Desk.",e.valid=!1):2078<e.yy&&(e.error="For dates beyond 2078, please contact the Help Desk.",e.valid=!1));f&&e.valid&&(a.value="dd/mm/yyyy"==c?e.dd+"/"+e.mm+"/"+e.yy:"mm/dd/yyyy"==c?e.mm+"/"+e.dd+"/"+e.yy:e.dd+"-"+e.mon+"-"+e.yy,a.title=c);if(b)return e.error;e.valid||(alert(e.error),
f&&focusSelect(a));return e.valid};validateRange=function(a,b,c,e){isField(e)&&(e.value=a);return a<b||a>c?(alert("The number entered is invalid. The value must be between "+b+" and "+c+"."),isField(e)&&focusSelect(e),!1):!0};validateFloat=function(a,b,c){if(""==trim(a))return!0;b=toFloatMax(b,2147483647);c=toFloatMin(c,-b);return validateFloatRange(a,c,b)};validateFloatRange=function(a,b,c,e){b=toFloat(b);c=toFloat(c);e=toFloat(e,b);e=toFloat(trim(a),e);return validateRange(e,b,c,a)};
validateIntRange=function(a,b,c,e){b=toInt(b);c=toInt(c);e=toInt(e,b);e=toInt(trim(a),e);return validateRange(e,b,c,a)};validateInt=function(a,b,c,e){b=toIntMax(b,2147483647);c=toIntMin(c,-b);return validateIntRange(a,c,b,e)};validateSmallInt=function(a,b,c,e){b=toIntMax(b,32767);c=toIntMin(c,-b);return validateIntRange(a,c,b,e)};validateTinyInt=function(a,b,c,e){b=toIntMax(b,255);c=toIntMin(c,0);return validateIntRange(a,c,b,e)};zeroPad=function(a,b){for(a=a.toString();a.length<b;)a="0"+a;return a};
hopsClickRow=function(){var a=$(this).data("rowid")||0,b=$("#infoHops");hopsScatter(qryHops.DATA[a],b)};hopsInit=function(){queryMakeHashable(qryHops);for(var a=$("#tabHops"),b=a.find("tbody"),c=b.find("tr"),e=0;e<qryHops.DATA.length;e++){var f=c.clone();hopsScatter(qryHops.DATA[e],f);f.attr("id","hp_rowid"+e);f.data("rowid",e);b.append(f)}c.remove();a.tablescroller({id:"Hops",height:330,sort:!0,print:!1,borderWidth:1,borderColor:"#979F97"});b.find("tr").click(hopsClickRow);hopsClickRow()};
hopsMakeInfo=function(a,b,c){return""==c[b]?"":"<span class='normal smallcaps'>"+a+":</span> "+c[b]+"<br><br>"};
hopsScatter=function(a,b){b.find(".hp_hop").html(a.HP_HOP);b.find(".hp_grown").find("img").attr("class","flagSM flag"+a.HP_GROWN.replace(" ","")).attr("title",a.HP_GROWN);b.find(".hp_grown").find("span").html(a.HP_GROWN);b.find(".hp_lvb").html(a.HP_LVB);b.find(".hp_aalow").html(a.HP_AALOW.toFixed(1));b.find(".hp_aahigh").html(a.HP_AAHIGH.toFixed(1));b.find(".hp_dry").find("img").attr("class","bih-icon bih-icon-checked"+iif(a.HP_DRY,"1","0"));b.find(".hp_aroma").find("img").attr("class","bih-icon bih-icon-checked"+
iif(a.HP_AROMA,"1","0"));b.find(".hp_bitter").find("img").attr("class","bih-icon bih-icon-checked"+iif(a.HP_BITTER,"1","0"));b.find(".hp_finish").find("img").attr("class","bih-icon bih-icon-checked"+iif(a.HP_FINISH,"1","0"));if("infoHops"==b.attr("id")){b.find(".hp_aa").html(a.HP_AALOW.toFixed(1)+" - "+a.HP_AAHIGH.toFixed(1));var c=hopsMakeInfo("Profile","HP_PROFILE",a),c=c+hopsMakeInfo("Use","HP_USE",a),c=c+hopsMakeInfo("Substitute","HP_SUB",a),c=c+hopsMakeInfo("Examples","HP_EXAMPLE",a),c=c+hopsMakeInfo("Info",
"HP_INFO",a);b.find("div.hp_info").html(c);rowHighlight(b,"hp_rowid",a._ROWID)}else b.find(".hp_aalow").html(a.HP_AALOW.toFixed(1)),b.find(".hp_aahigh").html(a.HP_AAHIGH.toFixed(1)),b.find("div.hp_profile").html(a.HP_PROFILE.left(50))};hopsScrollTo=function(){var a=$("#tabScrollBodyHops").find("tbody").find("#hp_rowid"+selectedRow.rowid);$("#divScrollBodyHops").scrollTo(a,800)};var validUser="",autoProcess=!1;
forgotProcess=function(){var a=document.frmUser;if(isEmpty(a.username,"Username is required."))return!0;a.submit()};loginCallBack=function(a){a.SUCCESS?a.DATA.VALIDATED?window.location="index.cfm":loginShowMsg("Login Failed. "+a.DATA.LOGINMSG,"loginmsg"):cbErrors(a)};loginClearMsg=function(a){a&&(a=$("#"+a),a.length&&a.fadeOut(800,function(){$(this).html("&nbsp;").show()}))};
loginProcess=function(){var a=document.frmLogin;if(isEmpty(a.username))return loginShowMsg("Login Failed. User Name is required.","loginmsg"),a.username.focus(),!1;if(isEmpty(a.password))return loginShowMsg("Login Failed. Password is required.","loginmsg"),a.password.focus(),!1;loginShowMsg(imgAjaxRunSm,"loginmsg");remoteCall("Users.Login",{user:a.username.value,pwd:a.password.value,rem:a.remember.checked},loginCallBack)};
loginShowMsg=function(a,b){if(b){var c=$("#"+b);if(c.length){c.html(a);setTimeout("loginClearMsg('"+b+"')",5E3);return}}showStatusWindow(a)};
verifyCallBack=function(a){a.SUCCESS?a.DATA.EXISTS?(loginShowMsg("Username already exists...","loginmsg"),verifySetIcon("ui-icon-alert","ui-state-error")):a.DATA.VALID?"Exists"==a.DATA.METHOD?(loginShowMsg("Username Available!","loginmsg"),verifySetIcon("ui-icon-check"),validUser=a.DATA.USER,autoProcess&&signupProcess(),autoProcess=!1):"SignUp"==a.DATA.METHOD&&(window.location="p.signup.cfm?done=0"):(loginShowMsg("Username is invalid...","loginmsg"),verifySetIcon("ui-icon-alert","ui-state-error")):
cbErrors(a)};verifyClear=function(){verifySetIcon("ui-icon-bullet")};
verifyProcess=function(){var a=document.frmUser;if(isEmpty(a.username,"Username is required."))return!0;if(isNotREMatch(a.username,/^[A-Za-z0-9]{4,20}$/,"Username must be at least 4 characters and contain only letters and numbers."))return!1;if(isNotEqual(validUser,a.username.value))return verifyUser(!0);if(isEmpty(a.password,"Password is required.")||isNotREMatch(a.password,/^[A-Za-z0-9!@#$%^&*()_]{5,20}$/,"Password must be at least 5 characters.")||isEmpty(a.password2,"Confirmed Password is required.")||
isNotEqual(a.password.value,a.password2.value,"Passwords do not match.")||isEmpty(a.email,"Email is required.")||isNotEmail(a.email,"Email is invalid.")||isEmpty(a.email2,"Confirmed Email is required.")||isNotEqual(a.email.value,a.email2.value,"Emails do not match."))return!1;var b={};b.user=validUser;b.pwd=a.password.value;b.email=a.email.value;remoteCall("Users.SignUp",b,verifyCallBack)};verifySetIcon=function(a,b){$("#icoVerify").attr("class",b||"").find("img").attr("class","ui-icon "+a)};
verifyUser=function(a){var b=document.frmUser;if(isEmpty(b.username))return loginShowMsg("Username required...","loginmsg"),verifySetIcon("ui-icon-alert","ui-state-error"),!0;if(isNotREMatch(b.username,/^[A-Za-z0-9]{4,20}$/))return loginShowMsg("Username Invalid...","loginmsg"),verifySetIcon("ui-icon-alert","ui-state-error"),!0;loginShowMsg(imgAjaxRunSm,"loginmsg");validUser="";autoProcess=a;remoteCall("Users.CheckExists",{user:b.username.value},verifyCallBack)};
miscClickRow=function(){var a=$(this).data("rowid")||0,b=$("#infoMisc");miscScatter(qryMisc.DATA[a],b)};miscInit=function(){queryMakeHashable(qryMisc);for(var a=$("#tabMisc"),b=a.find("tbody"),c=b.find("tr"),e=0;e<qryMisc.DATA.length;e++){var f=c.clone();miscScatter(qryMisc.DATA[e],f);f.attr("id","mi_rowid"+e);f.data("rowid",e);b.append(f)}c.remove();a.tablescroller({id:"Misc",height:330,sort:!0,print:!1,borderWidth:1,borderColor:"#979F97"});b.find("tr").click(miscClickRow);miscClickRow()};
miscScatter=function(a,b){b.find(".mi_type").html(a.MI_TYPE);b.find(".mi_use").html(a.MI_USE);b.find(".mi_phase").html(a.MI_PHASE);"infoMisc"==b.attr("id")?(b.find(".mi_unit").html(a.MI_UNIT),b.find("div.mi_info").html(a.MI_INFO),rowHighlight(b,"mi_rowid",a._ROWID)):b.find("div.mi_info").html(left(a.MI_INFO,50))};miscScrollTo=function(){var a=$("#tabScrollBodyMisc").find("tbody").find("#mi_rowid"+selectedRow.rowid);a.length&&$("#divScrollBodyMisc").scrollTo(a,800)};
var selectedRow={tab:"",row:0,rowid:0},metaRecipe={RE_REID:["int",0,"<input type=hidden />",""],RE_NAME:["varchar",35,"<input type=text maxlength=35 />",""],RE_VOLUME:["decimal",4.2,"<input type=text maxlength=7 class=decimal />",""],RE_BOILVOL:["decimal",4.2,"<input type=text maxlength=7 class=decimal />",""],RE_STYLE:["varchar",35,"<input type=text maxlength=35 />",""],RE_EFF:["int",0,"<input type=text maxlength=3 class=integer />",""],RE_EXPGRV:["decimal",1.3,"<input type=text maxlength=5 class=decimal readonly=readonly />",
""],RE_EXPSRM:["int",0,"<input type=text maxlength=5 class=decimal readonly=readonly />",""],RE_EXPIBU:["decimal",3.1,"<input type=text maxlength=5 class=decimal readonly=readonly />",""],RE_PRIME:["varchar",500,"<textarea></textarea>",""],RE_VUNITS:["varchar",12,"<select class=vunits></select>",""],RE_MUNITS:["varchar",12,"<select class=wunits></select>",""],RE_HUNITS:["varchar",12,"<select class=wunits></select>",""],RE_TUNITS:["varchar",10,"<button class='butRotate tunits' type=button></button>",
function(a){return TempUnits[a]}],RE_EUNITS:["varchar",5,"<button class='butRotate eunits' type=button></button>",""],RE_BREWED:["date",10,"<input type=text maxlength=10 class=date />",function(){alert("no")}],RE_TYPE:["varchar",10,"<input type=text maxlength=10 />",""],RE_GRNAMT:["decimal",4.2,"<input type=text maxlength=7 class=decimal readonly=readonly />",""],RE_MASHAMT:["decimal",4.2,"<input type=text maxlength=7 class=decimal readonly=readonly />",""],RE_HOPAMT:["decimal",4.2,"<input type=text maxlength=7 class=decimal readonly=readonly />",
""],RE_NOTES:["varchar",5E3,"<textarea></textarea>",""],RE_HOPCNT:["tinyint",2,"<input type=text maxlength=2 class=integer readonly=readonly />",""],RE_GRNCNT:["tinyint",2,"<input type=text maxlength=2 class=integer readonly=readonly />",""]},metaRecipeGrains={RG_RGID:["int",0,"<input type=hidden />",""],RG_REID:["int",0,"<input type=hidden />",""],RG_TYPE:["varchar",25,"<input type=text maxlength=25 />",""],RG_AMOUNT:["decimal",4.2,"<input type=text maxlength=7 class=decimal />",""],RG_SGC:["decimal",
1.3,"<input type=text maxlength=5 class=decimal />",""],RG_LVB:["int",4.1,"<input type=text maxlength=5 class=decimal />",""],RG_MASH:["boolean",1,"<input type=checkbox />",""],RG_MALTSTER:["varchar",25,"<input type=text maxlength=25 />",""],RG_PCT:["decimal",3.1,"<input type=text maxlength=5 class=decimal readonly=readonly disabled=disabled />",""]},metaRecipeHops={RH_RHID:["int",0,"<input type=hidden />",""],RH_REID:["int",0,"<input type=hidden />",""],RH_HOP:["varchar",25,"<input type=text maxlength=25 />",
""],RH_AAU:["decimal",2.1,"<input type=text maxlength=4 class=decimal />",""],RH_AMOUNT:["decimal",4.2,"<input type=text maxlength=7 class=decimal />",""],RH_FORM:["varchar",6,"<button type=button class=butRotate onclick='recipeHopForm(this)'></button>",""],RH_TIME:["tinyint",3,"<input type=text maxlength=3 class=integer />",""],RH_IBU:["decimal",3.1,"<input type=text maxlength=5 class=decimal />",""],RH_GROWN:["varchar",15,"<input type=text maxlength=15 />",""],RH_WHEN:["varchar",4,"<button type=button class=butRotate onclick='recipeHopWhen(this)'></button>",
""]},metaRecipeYeast={RY_RYID:["int",0,"<input type=hidden />",""],RY_REID:["int",0,"<input type=hidden />",""],RY_YEAST:["varchar",25,"<input type=text maxlength=25 />",""],RY_MFG:["varchar",20,"<input type=text maxlength=20 />",""],RY_MFGNO:["varchar",10,"<input type=text maxlength=10 />",""],RY_DATE:["date",10,"<input type=text maxlength=11 class=date />",""],RY_NOTE:["varchar",2E3,"<input type=text maxlength=2000 />",""]},metaRecipeDates={RD_RDID:["int",0,"<input type=hidden />",""],RD_REID:["int",
0,"<input type=hidden />",""],RD_DATE:["date",10,"<input type=text maxlength=11 class=date />",""],RD_TYPE:["varchar",10,"<button type=button class=butRotate onclick='rotateDateType(this)'></button>",""],RD_GRAVITY:["decimal",1.3,"<input type=text maxlength=5 class=decimal />",""],RD_TEMP:["decimal",3.1,"<input type=text maxlength=5 class=decimal />",""],RD_NOTE:["varchar",2E3,"<input type=text readonly=readonly maxlength=2000 />",""]},metaRecipeMisc={RM_RMID:["int",0,"<input type=hidden />",""],
RM_REID:["int",0,"<input type=hidden />",""],RM_TYPE:["varchar",25,"<input type=text maxlength=25 />",""],RM_AMOUNT:["decimal",4.2,"<input type=text maxlength=7 class=decimal />",""],RM_UNIT:["varchar",12,"<select></select>",""],RM_UTYPE:["varchar",1,"<input type=hidden />",""],RM_NOTE:["varchar",25,"<input type=text maxlength=25 />",""],RM_PHASE:["varchar",8,"<button type=button class=butRotate onclick='recipeMiscPhase(this)'></button>",""],RM_ACTION:["varchar",12,"<button type=button class=butRotate onclick='rotateMiscAction(this)'></button>",
""],RM_OFFSET:["tinyint",3,"<input type=text maxlength=3 class=integer />",""],RM_ADDED:["varchar",15,"<button type=button class=butRotate onclick='rotateMiscAdded(this)'></button>",""],RM_SORT:["varchar",8,"<input type=hidden />",""]},$note_data,$note_edit,$Recipe={},$RecipeDates=[],$RecipeGrains=[],$RecipeHops=[],$RecipeMisc=[],$RecipeYeast=[],frm,idxTabs={};
calc2rcpGravity=function(){var a="";if("tabRecipeDates"==selectedRow.tab){var b=$("#rd_gravity"+selectedRow.row),a=$Recipe.re_eunits.html(),c=$("#rd_temp"+selectedRow.row),e=$Recipe.re_tunits.val(),f=$("#gravity_temp").val(),g=$("#gravity_tunits").val();c.val(convertTemp(g,f,e).toFixed(1))}""==a?showStatusWindow("No Gravity field selected."):(a="SG"==a?parseFloat($("#hc_sg").val()).toFixed(3):parseFloat($("#hc_plato").val()).toFixed(1),b.val(a).select().focus())};
calc2rcpTemp=function(){var a="";if("tabRecipeDates"==selectedRow.tab)var b=$("#rd_temp"+selectedRow.row),a=$Recipe.re_tunits.val();""==a?showStatusWindow("No temperature field selected."):(a="F"==a?$("#temp_f").val():$("#temp_c").val(),b.val(parseFloat(a).toFixed(2)).select().focus())};
calc2rcpVolume=function(){var a="";if("tabRecipe"==selectedRow.tab&&"re_volume"==selectedRow.row)var b=$Recipe.re_volume,a=$Recipe.re_vunits.val();if(""==a)showStatusWindow("No volume field selected.");else{var c=$(".convertLiters").val();b.val(convertVolume("Liters",c,a).toFixed(2)).select().focus()}};
calc2rcpWeight=function(){var a="";if("tabRecipeGrains"==selectedRow.tab)var b=$("#rg_amount"+selectedRow.row),a=$Recipe.re_munits.val();else"tabRecipeHops"==selectedRow.tab&&(b=$("#rh_amount"+selectedRow.row),a=$Recipe.re_hunits.val());if(""==a)showStatusWindow("No weight field selected.");else{var c=$(".convertGrams").val();b.val(convertWeight("Grams",c,a).toFixed(2)).select().focus()}};
rcp2calcGravity=function(){if(window.calcClear&&!isEmpty(selectedRow.tab||"")){var a;if("tabRecipeDates"==selectedRow.tab){var b=$RecipeDates[selectedRow.row].rd_gravity[0].value;a=$Recipe.re_eunits.text();var c=$RecipeDates[selectedRow.row].rd_temp[0].value,e=$Recipe.re_tunits.val(),f=document.getElementById("gravity_tunits").value;document.getElementById("gravity_temp").value=convertTemp(e,c,f).toFixed(1)}c=convertGravity(a,b,"SG");document.getElementById("gravity_sg").value=c.toFixed(3);document.getElementById("gravity_plato").value=
convertGravity(a,b,"Plato").toFixed(1);gravityCalc(c)}};rcp2calcTemp=function(){if(window.calcClear&&!isEmpty(selectedRow.tab||"")){var a;if("tabRecipeDates"==selectedRow.tab){a=$Recipe.re_tunits.val();var b=$RecipeDates[selectedRow.row].rd_temp[0].value}document.getElementById("temp_f").value=convertTemp(a,b,"F").toFixed(1);document.getElementById("temp_c").value=convertTemp(a,b,"C").toFixed(1)}};
rcp2calcVolume=function(){if(window.calcClear&&!isEmpty(selectedRow.tab||"")){var a,b;if("tabRecipe"==selectedRow.tab)"re_volume"==selectedRow.row&&(b=$Recipe.re_vunits.val(),a=$Recipe.re_volume[0].value);else if("tabRecipeMisc"==selectedRow.tab){b=$RecipeMisc[selectedRow.row].rm_unit.val();if(void 0==LitersConvert[b])return;a=$RecipeMisc[selectedRow.row].rm_amount[0].value}calcClear("v",b,parseFloat(a)||0);ucalcCalc("v")}};
rcp2calcWeight=function(){if(window.calcClear&&!isEmpty(selectedRow.tab||"")){var a,b;if("tabRecipeGrains"==selectedRow.tab)b=$Recipe.re_munits.val(),a=$RecipeGrains[selectedRow.row].rg_amount[0].value;else if("tabRecipeHops"==selectedRow.tab)b=$Recipe.re_hunits.val(),a=$RecipeHops[selectedRow.row].rh_amount[0].value;else if("tabRecipeMisc"==selectedRow.tab){b=$RecipeMisc[selectedRow.row].rm_unit.val();if(void 0==GramsConvert[b])return;a=$RecipeMisc[selectedRow.row].rm_amount[0].value}calcClear("w",
b,parseFloat(a)||0);ucalcCalc("w")}};recipeAutoSource=function(a,b,c,e){for(var f=trim(a.term).split(" "),a=0;a<f.length;a++)f[a]=RegExp($.ui.autocomplete.escapeRegex(f[a]),"i");b($.grep(c,function(a){for(var b=0;b<f.length;b++){for(var c=!1,j=0;j<e.length;j++)c=f[b].test(a[e[j]])||c;if(!c)return!1}return!0}))};recipeCalendarSelect=function(a,b){if("tabRecipeDates"!=selectedRow.tab)return!1;$RecipeDates[selectedRow.row].rd_date[0].value=a;b.input[0].value="Date"};
recipeCalendarShow=function(){if("tabRecipeDates"!=selectedRow.tab)return showStatusWindow("No date field selected."),!1;var a=$RecipeDates[selectedRow.row].rd_date[0].value;$("#rd_datepick").datepicker("setDate",a)};
recipeCallBack=function(a){a.SUCCESS?"Invalid"==a.DATA.METHOD?showStatusWindow(a.DATA.message,500,!0):"Fetch"==a.DATA.METHOD?(recipeHashable(a.DATA.RCP),void 0==a.DATA.COPY?(RCP=a.DATA.RCP,recipeDataLoad()):recipeCopy(a.DATA)):"ParseXML"==a.DATA.METHOD?recipeImportLoad(a.DATA.Recipes):"Delete"==a.DATA.METHOD?(showStatusWindow("Recipe Deleted."),window.qryBrewLog&&$("#bl_reid"+key).fadeOut(),recipeFetch(0)):"Insert"==a.DATA.METHOD?(showStatusWindow("Recipe Added."),RCP=recipeHashable(a.DATA.RCP),recipeDataLoad()):
"Update"==a.DATA.METHOD&&(showStatusWindow("Recipe Saved."),RCP=recipeHashable(a.DATA.RCP),recipeDataLoad()):cbErrors(a)};recipeChildLoad=function(a,b,c,e){for(var f=[],c=$(c).find("tbody").find("td").empty(),g=0,i=0;i<a.DATA.length;i++){var h={};c.each(function(){var a=$(this);h[a.attr("id")]=recipeCreateInput(a,g,b)});"function"==typeof e&&e(g);loadRowToForm(a.DATA[i],frm,b,g);f[g++]=h}return f};
recipeChildSave=function(a,b,c){var e=0;$.each(a,function(a,g){"object"==typeof g&&(b.DATA.length-1<e&&(queryAddRow(b),"function"==typeof c&&c(b.DATA[e])),loadFormToRow(frm,b.DATA[e],a),b.DATA[e]._DELETED=!1,e++)});for(a=e;a<b.DATA.length;a++)b.DATA[a]._DELETED=!0;return e};
recipeCopy=function(a){a.COPY.incHeader&&loadRowToForm(RCP.qryRecipe.DATA[0],frm,metaRecipe);a.COPY.incGrains&&($RecipeGrains=recipeChildLoad(a.RCP.qryRecipeGrains,metaRecipeGrains,"#tabRecipeGrains"));a.COPY.incHops&&($RecipeHops=recipeChildLoad(a.RCP.qryRecipeHops,metaRecipeHops,"#tabRecipeHops"));a.COPY.incYeast&&($RecipeYeast=recipeChildLoad(a.RCP.qryRecipeYeast,metaRecipeYeast,"#tabRecipeYeast"));a.COPY.incMisc&&($RecipeMisc=recipeChildLoad(a.RCP.qryRecipeMisc,metaRecipeMisc,"#tabRecipeMisc",
recipeMiscRowInit));a.COPY.incDates&&($RecipeDates=recipeChildLoad(a.RCP.qryRecipeDates,metaRecipeDates,"#tabRecipeDates"))};recipeCopyAnswer=function(a){var a=$(a),b=a.closest("tbody").data("reid");$winModal.dialog("close");if("Open"==a.text())return recipeFetch(b);var c={};c.re_reid=b;c.copy={};$(document.frmCopy).find("input").each(function(){c.copy[this.name]=this.checked});remoteCall("Recipe.Fetch",c,recipeCallBack)};
recipeCopyShow=function(a){document.frmCopy.reset();var b=$("#tabCopy").find("tbody");b.data("reid",a);$winModal.bind("dialogclose",function(){$("#tabCopy").append($("#tabModal").find("tbody"))});$winModal.dialog("option","buttons",{Cancel:function(){$(this).dialog("close")}});$("#tabModal").append(b);$winModal.dialog("option","title","Open or Copy?");$winModal.dialog("open")};
recipeCreateInput=function(a,b,c){var e=a.attr("id");"icon"==a.attr("class")?c=$("<button class='ui-button-icon-tiny liveHover juiButton-icon-only ui-state-default ui-widget ui-button ui-button-icon-only' onclick='recipeRowDelete(this)' title='Delete' type='button'><span class='ui-button-icon-primary ui-icon ui-icon-trash'></span><span class='ui-button-text '>&nbsp;</span></button>").attr("name",e+b).attr("id",e+b).val(b):(c=c[e.toUpperCase()][metaInput],c=$(c).attr("name",e+b).attr("id",e+b).addClass(e));
c.data("row",b);var f=c;"ry_note"==e&&(f=$("<div class='editNote'><button class='ui-button-icon-tiny liveHover juiButton-icon-only ui-state-default ui-widget ui-button ui-button-icon-only' onclick='recipeYeastNote(this)' title='Edit' type='button'><span class='ui-button-icon-primary ui-icon ui-icon-script'></span><span class='ui-button-text '>&nbsp;</span></button></div>").append(c),f.attr("id","div"+e+b));f.addClass("rcpinp"+b);a.append(f);return c};
recipeDataAdd=function(){if(recipeIsChanged()&&!confirm("You are currently editing a recipe. Do you want to discard the changes and add a new recipe?"))return!1;recipeFetch(-1)};recipeDataCalcSave=function(a,b,c){a=$(a).find("input, select, button.butRotate");if(a.length){var e={};a.each(function(){e[this.id]=$(this).val()});b[c]=JSON.stringify(e)}};recipeDataCancel=function(){recipeDataLoad()};
recipeDataDelete=function(){if(confirm("Are you sure you want to delete this Recipe?")){if(RCP._ADD)return recipeDataCancel();if(RCP._LOCAL)return recipeDataDeleteLS();if(isLoggedIn()){RCP.qryRecipe.DATA[0]._DELETED=!0;var a={};a.qryRecipe=RCP.qryRecipe;remoteCall("Recipe.Process",a,recipeCallBack)}}};
recipeDataDeleteLS=function(){var a=RCP.qryRecipe.DATA[0].RE_REID;localStorage.removeItem("BIHDETAIL"+a.toString());var b=localStorage.getItem("BIHLIST"),b=b?b.split(","):[],b=$.grep(b,function(b){return b!=a});localStorage.setItem("BIHLIST",b.join(","));showStatusWindow("Recipe Deleted from Local Storage.");window.qryBrewLog&&$("#bl_reid"+a).fadeOut();recipeFetch()};
recipeDataLoad=function(){selectedRow={tab:"",row:0,rowid:0};loadRowToForm(RCP.qryRecipe.DATA[0],frm,metaRecipe);$RecipeGrains=recipeChildLoad(RCP.qryRecipeGrains,metaRecipeGrains,"#tabRecipeGrains");$RecipeHops=recipeChildLoad(RCP.qryRecipeHops,metaRecipeHops,"#tabRecipeHops");$RecipeYeast=recipeChildLoad(RCP.qryRecipeYeast,metaRecipeYeast,"#tabRecipeYeast");$RecipeMisc=recipeChildLoad(RCP.qryRecipeMisc,metaRecipeMisc,"#tabRecipeMisc",recipeMiscRowInit);$RecipeDates=recipeChildLoad(RCP.qryRecipeDates,
metaRecipeDates,"#tabRecipeDates");$rd_noteedit.val("").attr("disabled","disabled");recipeShowBrewed();if(0==RCP.qryRecipe.DATA[0].RE_REID){RCP._ADD=!0;$(".tabRowData").find("tbody").unbind("focusin");selectedRow={tab:"",row:0,rowid:0};for(var a=0;3>a;a++)recipeRowAdd(metaRecipeGrains,"#tabRecipeGrains",$RecipeGrains);for(a=0;3>a;a++)recipeRowAdd(metaRecipeHops,"#tabRecipeHops",$RecipeHops);recipeRowAdd(metaRecipeYeast,"#tabRecipeYeast",$RecipeYeast);recipeRowAdd(metaRecipeMisc,"#tabRecipeMisc",$RecipeMisc);
recipeRowAdd(metaRecipeDates,"#tabRecipeDates",$RecipeDates);$note_edit[0].value="";$(".tabRowData").find("tbody").focusin(recipeRowEdit);frm.re_name.focus()}else recipeSumGrains(),recipeGravityFromEff(),recipeSRM(),recipeSumHops(),recipeIBUs("IBU");calcClear("m");calcClear("k");calcClear("c");calcClear("a");recipeFieldOrder()};
recipeDataSave=function(){if(recipeIsValid()){loadFormToRow(frm,RCP.qryRecipe.DATA[0]);var a=RCP.qryRecipe.DATA[0].RE_REID;RCP.qryRecipe.DATA[0].RE_GRNCNT=recipeChildSave($RecipeGrains,RCP.qryRecipeGrains,function(b){b.RG_REID=a;b.RG_RGID=0});RCP.qryRecipe.DATA[0].RE_HOPCNT=recipeChildSave($RecipeHops,RCP.qryRecipeHops,function(b){b.RH_REID=a;b.RH_RHID=0});recipeChildSave($RecipeYeast,RCP.qryRecipeYeast,function(b){b.RY_REID=a;b.RY_RYID=0});recipeChildSave($RecipeMisc,RCP.qryRecipeMisc,function(b){b.RM_REID=
a;b.RG_RMID=0});recipeChildSave($RecipeDates,RCP.qryRecipeDates,function(b){b.RD_REID=a;b.RD_RGID=0});recipeDataCalcSave("#tabMash",RCP.qryRecipe.DATA[0],"RE_MASH");recipeDataCalcSave("#tabCarb",RCP.qryRecipe.DATA[0],"RE_PRIME");isLoggedIn()?(RCP.qryRecipe.DATA[0].RE_USID=bihUser.USID,remoteCall("Recipe.Process",RCP,recipeCallBack)):(recipeDataSaveLS(),recipeDataLoad())}};
recipeDataSaveLS=function(){if(!localStorage)return alert("Your browser does not support HTML5 local storage. Please create an account to save recipes.");if(RCP._ADD){var a=toInt(localStorage.getItem("BIHSEQ"),1E7);localStorage.setItem("BIHSEQ",++a);var b=localStorage.getItem("BIHLIST"),b=b?b.split(","):[];b.push(a);localStorage.setItem("BIHLIST",b.join(","));RCP.qryRecipe.DATA[0].RE_REID=a;RCP._LOCAL=!0;RCP._ADD=!1}localStorage.setItem("BIHDETAIL"+a.toString(),JSON.stringify(RCP));localStorage.setItem("BIHLAST",
a);showStatusWindow("Recipe Saved in Local Storage.")};
recipeEffFromGravity=function(){var a=parseFloat($Recipe.re_expgrv[0].value)||0;if(!(1>a)){for(var b=0,c=0,e=0;e<$RecipeGrains.length;e++)if($RecipeGrains[e]){var f=parseFloat($RecipeGrains[e].rg_sgc[0].value)||1,g=parseFloat($RecipeGrains[e].rg_amount[0].value)||0;$RecipeGrains[e].rg_mash[0].checked?b+=(f-1)*g:c+=(f-1)*g}e=convertVolume($Recipe.re_vunits.val(),$Recipe.re_volume[0].value,"Gallons");f=$Recipe.re_munits.val();b=convertWeight(f,b,"Lbs")/e;c=convertWeight(f,c,"Lbs")/e;a=100*((a-c-1)/
b);100<a?(showStatusWindow("Gravity entered would require > 100 % efficency"),$Recipe.re_eff[0].value=100,recipeGravityFromEff()):0>a?(showStatusWindow("Gravity entered would require < 0 % efficency"),$Recipe.re_eff[0].value=1,recipeGravityFromEff()):$Recipe.re_eff[0].value=a.toFixed(0)}};
recipeEventGrain=function(a){"change"==a.type&&(a.which=13);spinnerInc(a);if(!a.data.changed)return!0;a=a.target.name;a.starts("rg_amount")?(recipeSumGrains(),recipeGravityFromEff(),recipeSRM(),recipeIBUs("IBU")):a.starts("rg_sgc")||"re_eff"==a?(recipeGravityFromEff(),recipeIBUs("IBU")):a.starts("rg_lvb")?recipeSRM():a.starts("re_expgrv")&&recipeEffFromGravity()};
recipeEventHop=function(a){"change"==a.type&&(a.which=13);spinnerInc(a);if(!a.data.changed)return!0;var b=a.target.name,a=a.target.getAttribute("row");b.starts("rh_amount")?recipeIBUs("IBU"):b.starts("rh_aau")||b.starts("rh_time")?recipeIBUs("IBU"):b.starts("rh_ibu")&&recipeIBUs("Amount",a);recipeSumHops()};recipeEventVolume=function(a){"change"==a.type&&(a.which=13);spinnerInc(a);if(!a.data.changed)return!0;recipeGravityFromEff();recipeSRM();recipeIBUs("IBU")};
recipeFetch=function(a){if(isLoggedIn()&&!(1E7<a)||!recipeFetchLS(a)){var b={};b.re_reid=a;remoteCall("Recipe.Fetch",b,recipeCallBack)}};recipeFetchLS=function(a){if(!a){var a=localStorage.getItem("BIHLAST")||0,b=localStorage.getItem("BIHLIST"),b=b?b.split(","):[];-1==$.inArray(a,b)&&(a=!b.length?0:b.pop())}return 0!=a&&(RCP=JSON.parse(localStorage.getItem("BIHDETAIL"+a)))?(recipeCallBack({SUCCESS:!0,LOGGEDIN:!1,ERRORS:[],DATA:{RCP:RCP,METHOD:"Fetch"}}),!0):!1};
recipeFieldOrder=function(){var a=4,b="rg_type,rg_maltster,rg_mash,rg_amount,rg_sgc,rg_lvb".split(",");$.each($RecipeGrains,function(c,e){if("object"==typeof e)for(var f=0;f<b.length;f++)e[b[f]].attr("tabIndex",a++)});$Recipe.re_eff.attr("tabIndex",a++);$Recipe.re_expgrv.attr("tabIndex",a++);b="rh_hop,rh_grown,rh_form,rh_aau,rh_amount,rh_when,rh_time,rh_ibu".split(",");$.each($RecipeHops,function(c,e){if("object"==typeof e)for(var f=0;f<b.length;f++)e[b[f]].attr("tabIndex",a++)});$Recipe.re_boilvol.attr("tabIndex",
a++);b=["ry_yeast","ry_mfg","ry_mfgno","ry_note"];$.each($RecipeYeast,function(c,e){if("object"==typeof e)for(var f=0;f<b.length;f++)e[b[f]].attr("tabIndex",a++)});b="rm_type,rm_amount,rm_unit,rm_phase,rm_offset,rm_added,rm_action".split(",");$.each($RecipeMisc,function(c,e){if("object"==typeof e)for(var f=0;f<b.length;f++)e[b[f]].attr("tabIndex",a++)});b=["rd_date","rd_type","rd_gravity","rd_temp","rd_note"];$.each($RecipeDates,function(c,e){if("object"==typeof e)for(var f=0;f<b.length;f++)e[b[f]].attr("tabIndex",
a++)})};
recipeGrainsAuto=function(){var a=$RecipeGrains[selectedRow.row].rg_type;a.attr("autocomplete")||(a.autocomplete({source:function(a,c){return recipeAutoSource(a,c,qryGrains.DATA,["GR_TYPE","GR_MALTSTER"])},focus:function(){return!1},select:function(a,c){recipeGrainsFill(c.item);grainsScatter(c.item,$("#infoGrains"));grainsScrollTo();return!1}}),a.autocomplete("widget").addClass("ac_results"),a.data("autocomplete")._renderItem=function(a,c){return $("<li></li>").data("item.autocomplete",c).append("<a>"+c.GR_TYPE+
", "+c.GR_MALTSTER+"</a>").appendTo(a)})};
recipeGrainsFill=function(a){$RecipeGrains[selectedRow.row].rg_type[0].value=a.GR_TYPE;$RecipeGrains[selectedRow.row].rg_maltster[0].value=a.GR_MALTSTER;$RecipeGrains[selectedRow.row].rg_mash.attr("checked",a.GR_MASH);$RecipeGrains[selectedRow.row].rg_sgc[0].value=a.GR_SGC.toFixed(3);$RecipeGrains[selectedRow.row].rg_lvb[0].value=a.GR_LVB;$RecipeGrains[selectedRow.row].rg_amount[0].focus();toFloatMin($RecipeGrains[selectedRow.row].rg_amount[0].value,0)&&(recipeGravityFromEff(),recipeSRM());selectedRow.rowid=
a._ROWID};recipeGrainsFind=function(){if($RecipeGrains.length){var a=0;"tabRecipeGrains"==selectedRow.tab&&(a=selectedRow.row,recipeGrainsAuto());a=querySearchIdx(qryGrains,idxGrains,"GR_TYPE",$RecipeGrains[a].rg_type[0].value,"GR_MALTSTER",$RecipeGrains[a].rg_maltster[0].value);-1!=a&&(selectedRow.rowid=a,grainsScatter(qryGrains.DATA[a],$("#infoGrains")),grainsScrollTo())}};recipeGrainsPick=function(a){"tabRecipeGrains"==selectedRow.tab&&(a=$(a).parents("tr").data("rowid")||0,recipeGrainsFill(qryGrains.DATA[a]))};
recipeGravityFromEff=function(){for(var a=0,b=parseInt($Recipe.re_eff[0].value),c=$Recipe.re_munits.val(),e=0;e<$RecipeGrains.length;e++)if($RecipeGrains[e])var f=parseFloat($RecipeGrains[e].rg_sgc[0].value)||1,g=parseFloat($RecipeGrains[e].rg_amount[0].value)||0,a=a+(f-1)*g*($RecipeGrains[e].rg_mash[0].checked?b/100:1);a=1+convertWeight(c,a,"Lbs")/convertVolume($Recipe.re_vunits.val(),$Recipe.re_volume[0].value,"Gallons");b=$Recipe.re_eunits.text();$Recipe.re_expgrv[0].value=formatGravity(convertGravity("SG",
a,b),b);getById("re_expgrv2").value=$Recipe.re_expgrv[0].value};recipeHashable=function(a){queryMakeHashable(a.qryRecipe);queryMakeHashable(a.qryRecipeGrains);queryMakeHashable(a.qryRecipeHops);queryMakeHashable(a.qryRecipeYeast);queryMakeHashable(a.qryRecipeMisc);queryMakeHashable(a.qryRecipeDates);return a};recipeHopForm=function(a){rotateHopForm(a);recipeIBUs("IBU")};
recipeHopsAuto=function(){var a=$RecipeHops[selectedRow.row].rh_hop;a.attr("autocomplete")||(a.autocomplete({source:function(a,c){return recipeAutoSource(a,c,qryHops.DATA,["HP_HOP","HP_GROWN"])},focus:function(){return!1},select:function(a,c){recipeHopsFill(c.item);hopsScatter(c.item,$("#infoHops"));hopsScrollTo();return!1}}),a.autocomplete("widget").addClass("ac_results"),a.data("autocomplete")._renderItem=function(a,c){return $("<li></li>").data("item.autocomplete",c).append("<a>"+c.HP_HOP+", "+
c.HP_GROWN+"</a>").appendTo(a)})};
recipeHopsFill=function(a){$RecipeHops[selectedRow.row].rh_hop[0].value=a.HP_HOP;$RecipeHops[selectedRow.row].rh_grown[0].value=a.HP_GROWN;$RecipeHops[selectedRow.row].rh_aau[0].value=a.HP_AALOW;$RecipeHops[selectedRow.row].rh_aau[0].focus();if(0<selectedRow.row){var b=selectedRow.row-1;if(($RecipeHops[b].rh_hop[0].value||"")==a.HP_HOP)$RecipeHops[selectedRow.row].rh_aau[0].value=$RecipeHops[b].rh_aau[0].value,rotateSetVal($RecipeHops[selectedRow.row].rh_form[0],$RecipeHops[b].rh_form[0].value),rotateSetVal($RecipeHops[selectedRow.row].rh_when[0],
$RecipeHops[b].rh_when[0].value)}selectedRow.rowid=a._ROWID};recipeHopsFind=function(){if($RecipeHops.length){var a=0;"tabRecipeHops"==selectedRow.tab&&(a=selectedRow.row,recipeHopsAuto());a=querySearchIdx(qryHops,idxHops,"HP_HOP",$RecipeHops[a].rh_hop[0].value,"HP_GROWN",$RecipeHops[a].rh_grown[0].value);-1!=a&&(selectedRow.rowid=a,hopsScatter(qryHops.DATA[a],$("#infoHops")),hopsScrollTo())}};recipeHopsPick=function(a){"tabRecipeHops"==selectedRow.tab&&(a=$(a).parents("tr").data("rowid")||0,recipeHopsFill(qryHops.DATA[a]))};
recipeHopWhen=function(a){rotateHopWhen(a);recipeIBUs("IBU")};
recipeIBUs=function(a,b){var c=0,e=0,f=$Recipe.re_vunits.val(),g=$Recipe.re_volume[0].value,i=$Recipe.re_boilvol[0].value,h=$Recipe.re_eunits.text(),j=$Recipe.re_expgrv[0].value,l=$Recipe.re_hunits.val(),k=0,o=$RecipeHops.length;void 0!=b&&(k=parseInt(b),o=k+1);for(;k<o;k++)if($RecipeHops[k]){var q=$RecipeHops[k].rh_form[0].value,p=$RecipeHops[k].rh_aau[0].value,n=$RecipeHops[k].rh_amount[0].value,s=$RecipeHops[k].rh_when[0].value,r=$RecipeHops[k].rh_time[0].value;if("Amount"==a){var m=$RecipeHops[k].rh_ibu[0].value,
n=ibuAmountFromIBU(f,g,h,j,l,m,p,q,r,s,i);$RecipeHops[k].rh_amount[0].value=n.toFixed(2)}else m=ibuIBUFromAmount(f,g,h,j,l,n,p,q,r,s,i),$RecipeHops[k].rh_ibu[0].value=m.toFixed(1);c+=m;e+=parseFloat(n)||0}void 0==b&&($Recipe.re_hopamt[0].value=e.toFixed(2),$Recipe.re_expibu[0].value=c.toFixed(0),getById("re_expibu2").value=$Recipe.re_expibu[0].value)};
recipeImport=function(){if(recipeIsChanged()&&!confirm("You are currently editing a recipe. Do you want to discard the changes and import a recipe?"))return!1;var a=$("#tabImport").find("tbody");$winModal.bind("dialogclose",function(){$("#tabImport").append($("#tabModal").find("tbody"))});$winModal.dialog("option","buttons",{Import:function(){recipeImportValidate()},Cancel:function(){$(this).dialog("close")}});$("#tabModal").append(a);$("#xml_text").val("");$winModal.dialog("option","title","Beer.xml Import");
$winModal.dialog("open")};
recipeImportLoad=function(a){var b=a.length;if(b){if(1<b)if(localStorage){qryBrewLog={DATA:[]};for(var c=1;c<b;c++){recipeHashable(a[c]);var e=toInt(localStorage.getItem("BIHSEQ"));localStorage.setItem("BIHSEQ",++e);var f=localStorage.getItem("BIHLIST"),f=f?f.split(","):[];f.push(e);localStorage.setItem("BIHLIST",f.join(","));a[c].qryRecipe.DATA[0].RE_REID=-e;localStorage.setItem("BIHDETAIL"+e.toString(),JSON.stringify(a[c]));localStorage.setItem("BIHLAST",e);qryBrewLog.DATA.push(a[c].qryRecipe.DATA[0])}b--;$divToolbarTabs.tabs("load",
idxTabs.Recipes);showStatusWindow(b+" additional beer recipes were imported and saved to local storage. They can be viewed and saved from the Brew Log.")}else alert("Your browser does not support HTML5 local storage.")}else return showStatusWindow("A beer recipe was not found in the provided XML.");recipeHashable(a[0]);RCP=a[0];recipeDataLoad();$winModal.dialog("close")};
recipeImportValidate=function(){var a=$("#xml_text"),b=a.val();if(!isEmpty(a[0],"You must paste valid xml.")){try{var c=$.parseXML(b)}catch(e){return alert("Please provide only valid xml data.")}a=c.getElementsByTagName("RECIPE");if(!a.length)return alert("A beer recipe was not found in the provided XML.");a=1==a.length?a[0].getElementsByTagName("NAME")[0].textContent:a.length+addS(" recipe",a.length);remoteCall("BeerXML.ParseXML",{xml:b},recipeCallBack);showStatusWindow("Importing "+a+"...")}};
recipeInit=function(){frm=document.frmRecipe;popUnitSelect(".vunits",LitersConvert);popUnitSelect(".wunits",GramsConvert);$note_edit=$("#note_edit");$rd_noteedit=$("#rd_noteedit");$("#rd_datepick").datepicker({showOn:"button",buttonImageOnly:!0,buttonImage:"images/trans.gif",beforeShow:recipeCalendarShow,onSelect:recipeCalendarSelect});$("#tabRecipeDates").find(".ui-datepicker-trigger").addClass("bih-icon bih-icon-calendar");$("[name^='re_']").focus(recipeRowEdit);$(".tabRowData").find("tbody").focusin(recipeRowEdit);
$divRecipeTabs=$("#divRecipeTabs").tabs({show:recipeTabShow,cache:!0,spinner:"<span class=font7>Brewing&#8230;</span>"});$divToolbarTabs=$("#divToolbarTabs").tabs({load:recipeTabLoadedTB,select:recipeTabSelectedTB,cache:!0,spinner:"<span class=font7>Brewing&#8230;</span>",ajaxOptions:{cache:!1}});$divToolbarTabs.find("li").each(function(a){var c=$(this),e=$(this).find("a").text();idxTabs[e]=a;c.removeClass("ui-corner-top").addClass("ui-corner-all");c.find("a").attr("title",e)});$divToolbarTabs.find("ul").removeClass("ui-widget-header");
$("#ulToolbarTabs").removeClass("ui-corner-all").addClass("ui-corner-bl");var a=$("<div>").attr("id","divToolbarTabWrap").addClass("toolbarIn");$divToolbarTabs.find(">div").each(function(){a.append(this)});$divToolbarTabs.append(a);$("#divToolbarConvert").removeClass("ui-tabs-hide");$divToolbarTabs.find("button").click(function(){$(this);$divToolbarTabs.tabs("select",idxTabs[this.title]);recipeToolbarToggle()});$divToolbarTabs.find("a").click(function(){recipeToolbarToggle()});$Recipe.re_style=$("#re_style");
$Recipe.re_vunits=$("#re_vunits");$Recipe.re_munits=$("#re_munits");$Recipe.re_tunits=$("#re_tunits");$Recipe.re_eunits=$("#re_eunits");$Recipe.re_hunits=$("#re_hunits");$Recipe.re_expsrm=$("#re_expsrm");$Recipe.re_expibu=$("#re_expibu");$Recipe.re_brewed=$("#re_brewed");$Recipe.re_grnamt=$("#re_grnamt");$Recipe.re_hopamt=$("#re_hopamt");$Recipe.re_eff=spinnerBind($("#re_eff"),incPct,recipeEventGrain);$Recipe.re_volume=spinnerBind($("#re_volume"),incAmt,recipeEventVolume);$Recipe.re_boilvol=spinnerBind($("#re_boilvol"),
incAmt,recipeEventHop);$Recipe.re_expgrv=spinnerBindGravity($("#re_expgrv"),bihDefaults.EUNITS,recipeEventGrain);$("#rg_mash").on("change",recipeGravityFromEff);spinnerBind($("#rg_amount"),incAmt,recipeEventGrain);spinnerBind($("#rg_sgc"),incSGC,recipeEventGrain);spinnerBind($("#rg_lvb"),incLvb,recipeEventGrain);spinnerBind($("#rh_aau"),incAAU,recipeEventHop);spinnerBind($("#rh_amount"),incAmt,recipeEventHop);spinnerBind($("#rh_time"),incTime,recipeEventHop);spinnerBind($("#rh_ibu"),incIBU,recipeEventHop);
spinnerBind($("#rm_amount"),incAmt,spinnerInc);spinnerBind($("#rm_offset"),incTime,spinnerInc);spinnerBindGravity($("#rd_gravity"),bihDefaults.EUNITS,spinnerInc);spinnerBindTemp($("#rd_temp"),bihDefaults.TUNITS,spinnerInc);$(document).on("focus",".rd_note",function(){$rd_noteedit.focus()});$winModal=$("#winModal").dialog({autoOpen:!1,width:"auto",modal:!0});$("#divToolbar").draggable({grid:[20,20],distance:20,handle:$("#btnDragger"),start:function(){$(this).removeClass("easing")},stop:function(){$(this).addClass("easing")}});
recipeFetch(REID)};
recipeIsChanged=function(){if(0==RCP.qryRecipe.DATA[0].RE_REID)return!(isEmpty(frm.re_name)&&isEmpty(frm.re_style)&&isZero(frm.re_grmamt)&&isZero(frm.re_hopamt));if(!queryIsFormEqualRow(frm,RCP.qryRecipe.DATA[0],"",["re_expgrv","re_expibu","re_expsrm"])||$RecipeGrains.length!=RCP.qryRecipeGrains.DATA.length||$RecipeHops.length!=RCP.qryRecipeHops.DATA.length||$RecipeYeast.length!=RCP.qryRecipeYeast.DATA.length||$RecipeMisc.length!=RCP.qryRecipeMisc.DATA.length||$RecipeDates.length!=RCP.qryRecipeDates.DATA.length)return!0;
var a=!0;$.each($RecipeGrains,function(b,c){return a="object"==typeof c&&queryIsFormEqualRow(frm,RCP.qryRecipeGrains.DATA[b],b)});a&&$.each($RecipeHops,function(b,c){return a="object"==typeof c&&queryIsFormEqualRow(frm,RCP.qryRecipeHops.DATA[b],b,["rh_ibu"])});a&&$.each($RecipeYeast,function(b,c){return a="object"==typeof c&&queryIsFormEqualRow(frm,RCP.qryRecipeYeast.DATA[b],b)});a&&$.each($RecipeMisc,function(b,c){return a="object"==typeof c&&queryIsFormEqualRow(frm,RCP.qryRecipeMisc.DATA[b],b)});
a&&$.each($RecipeDates,function(b,c){return a="object"==typeof c&&queryIsFormEqualRow(frm,RCP.qryRecipeDates.DATA[b],b)});return!a};
recipeIsValid=function(){if(isEmpty(frm.re_name,"Recipe Name is required.")||isZero(frm.re_volume,"Volume is required.")||isEmpty(frm.re_style,"Style is required."))return!1;$.each($RecipeGrains,function(a,b){if("object"==typeof b)if(isEmpty(b.rg_type[0])&&isZero(b.rg_amount[0]))b.rg_delete.parents("table").find(".rcpinp"+a).fadeOut(),$RecipeGrains[a]=!1;else if(isEmpty(b.rg_type[0],"Malt/Fermentable Type is required.")||isZero(b.rg_amount[0],"Malt/Fermentable Amount is required.")||isZero(b.rg_sgc[0],
"Malt/Fermentable SGC is required.")||isZero(b.rg_lvb[0],"Malt/Fermentable SRM is required."))return!1});$.each($RecipeHops,function(a,b){if("object"==typeof b)if(isEmpty(b.rh_hop[0])&&isZero(b.rh_amount[0])&&isZero(b.rh_aau[0]))b.rh_delete.parents("table").find(".rcpinp"+a).fadeOut(),$RecipeHops[a]=!1;else if(isEmpty(b.rh_hop[0],"Hop is required.")||isZero(b.rh_aau[0],"Hop AAU is required.")||isZero(b.rh_amount[0],"Hop Amount is required."))return!1});$.each($RecipeYeast,function(a,b){if("object"==
typeof b)if(isEmpty(b.ry_yeast[0])&&isEmpty(b.ry_note[0]))b.ry_delete.parents("table").find(".rcpinp"+a).fadeOut(),$RecipeYeast[a]=!1;else if(isEmpty(b.ry_yeast[0],"Yeast is required."))return!1});$.each($RecipeMisc,function(a,b){if("object"==typeof b)if(isEmpty(b.rm_type[0])&&isZero(b.rm_amount[0]))b.rm_delete.parents("table").find(".rcpinp"+a).fadeOut(),$RecipeMisc[a]=!1;else if(isEmpty(b.rm_type[0],"Misc Ingredient is required.")||isZero(b.rm_amount[0],"Misc Ingredient Amount is required."))return!1});
$.each($RecipeDates,function(a,b){if("object"==typeof b)if(isEmpty(b.rd_date[0])&&isEmpty(b.rd_note[0]))b.rd_delete.parents("table").find(".rcpinp"+a).fadeOut(),$RecipeDates[a]=!1;else if(isEmpty(b.rd_date[0],"Misc Ingredient is required.")||!validateDate(b.rd_date[0]))return!1});return!0};
recipeMiscAuto=function(){var a=$RecipeMisc[selectedRow.row].rm_type;a.attr("autocomplete")||(a.autocomplete({source:function(a,c){return recipeAutoSource(a,c,qryMisc.DATA,["MI_TYPE","MI_USE"])},focus:function(){return!1},select:function(a,c){recipeMiscFill(c.item);miscScatter(c.item,$("#infoMisc"));miscScrollTo();return!1}}),a.autocomplete("widget").addClass("ac_results"),a.data("autocomplete")._renderItem=function(a,c){return $("<li></li>").data("item.autocomplete",c).append("<a>"+c.MI_TYPE+", "+
c.MI_USE+"</a>").appendTo(a)})};recipeMiscFill=function(a){$RecipeMisc[selectedRow.row].rm_type[0].value=a.MI_TYPE;$RecipeMisc[selectedRow.row].rm_unit.val(a.MI_UNIT);var b=a.MI_PHASE;$RecipeMisc[selectedRow.row].rm_phase[0].innerHTML=b;$RecipeMisc[selectedRow.row].rm_added[0].innerHTML=Added[b]||Added.Default;$RecipeMisc[selectedRow.row].rm_action[0].innerHTML=Action[b];$RecipeMisc[selectedRow.row].rm_amount[0].focus();selectedRow.rowid=a._ROWID};
recipeMiscFind=function(){if($RecipeMisc.length){var a=0;"tabRecipeMisc"==selectedRow.tab&&(a=selectedRow.row,recipeMiscAuto());a=querySearchIdx(qryMisc,idxMisc,"MI_TYPE",$RecipeMisc[a].rm_type[0].value);-1!=a&&(selectedRow.rowid=a,miscScatter(qryMisc.DATA[a],$("#infoMisc")),miscScrollTo())}};recipeMiscPhase=function(a){var b=$(a).data("row");rotateMiscPhase(a,$RecipeMisc[b].rm_added[0],$RecipeMisc[b].rm_action[0])};
recipeMiscPick=function(a){"tabRecipeMisc"==selectedRow.tab&&(a=$(a).parents("tr").data("rowid")||0,recipeMiscFill(qryMisc.DATA[a]))};recipeMiscRowInit=function(a){popUnitSelect("#rm_unit"+a,GramsConvert);popUnitSelect("#rm_unit"+a,LitersConvert)};recipeNoteSave=function(){var a=$rd_noteedit.val().pipeCRLF(1);$RecipeDates[selectedRow.row].rd_note.val(a)};recipeOpen=function(a){a="Add"==a.title?-1:$(a).parents("tr").data("pk")||0;recipeIsChanged()?recipeCopyShow(a):recipeFetch(a)};
recipeRowAdd=function(a,b,c,e){var f=$(b),g=f.find(".ui-icon-arrowthickstop-1-s").parent();g.length&&tbodyHide(g[0]);b=b.right(b.length-10);a=recipeRowAddMeta(a,f,c,e);"Misc"==b?(popUnitSelect("#rm_unit"+a,GramsConvert),popUnitSelect("#rm_unit"+a,LitersConvert),$RecipeMisc[a].rm_unit.val(bihDefaults.HUNITS),$RecipeMisc[a].rm_phase.html("Mash"),recipeMiscPhase($RecipeMisc[a].rm_phase[0])):"Hops"==b?(rotateSetVal($RecipeHops[a].rh_form[0],bihDefaults.HOPFORM),rotateSetVal($RecipeHops[a].rh_when[0],
HopWhen.Default)):"Dates"==b&&(c=DateType.Default,f=$Recipe.re_expgrv[0].value,b=$Recipe.re_tunits[0].value,b=formatTemp(convertTemp("F",60,b),b),0<a&&(c=DateType[$RecipeDates[a-1].rd_type.html()],"Brewed"==c&&(c="Note"),f=$RecipeDates[a-1].rd_gravity[0].value,b=$RecipeDates[a-1].rd_temp[0].value),$RecipeDates[a].rd_type.html(c),$RecipeDates[a].rd_date[0].value=jsDateFormat(new Date,bihDefaults.DATEMASK),$RecipeDates[a].rd_gravity[0].value=f,$RecipeDates[a].rd_temp[0].value=b);e&&recipeFieldOrder()};
recipeRowAddMeta=function(a,b,c,e){var b=b.find("tbody").find("td"),f=b[0].childNodes.length,g,i={};b.each(function(b){var c=$(this);i[c.attr("id")]=recipeCreateInput(c,f,a);1==b&&(g=c.attr("id"))});c[f]=i;e&&(i[g].focus(),recipeRowEdit());return f};recipeRowDelete=function(a){var b=$(a),c=b.data("row");b.parents("table").find(".rcpinp"+c).fadeOut();a=left(a.id,2);"rg"==a?$RecipeGrains[c]=!1:"rh"==a?$RecipeHops[c]=!1:"ry"==a?$RecipeYeast[c]=!1:"rm"==a?$RecipeMisc[c]=!1:"rd"==a&&($RecipeDates[c]=!1)};
recipeRowEdit=function(){var a=document.activeElement.id||"";log("fld = "+a);if(a&&!("menuitem"==a.right(8)||"add"==a.right(3))){var b=$(document.activeElement);if("re_"==a.left(3))var c=b,e="tabRecipe";else c=b.parents("table"),e=c.attr("id"),a=b.data("row");if(""!=selectedRow.tab){if(selectedRow.tab==e&&selectedRow.row==a)return;var f=selectedRow.tab;selectedRow.row.left&&(f=selectedRow.row);recipeToggleBorders($("#"+f))}selectedRow.tab=e;selectedRow.row=a;recipeToggleBorders(c);c=!1;if("tabRecipe"==
selectedRow.tab)"re_style"==selectedRow.row?($divToolbarTabs.tabs("select",idxTabs.Styles),void 0!=window.qryBJCPStyles&&recipeStylesFind()):"re_volume"==selectedRow.row&&($divToolbarTabs.tabs("select",idxTabs.Convert),window.convertInit&&rcp2calcVolume());else if("tabRecipeDates"==selectedRow.tab)$rd_noteedit.val($RecipeDates[selectedRow.row].rd_note.val().pipeCRLF(0)),$rd_noteedit.removeAttr("disabled"),rcp2calcTemp(),rcp2calcGravity();else if("tabRecipeYeast"==selectedRow.tab?$note_edit.data("maxlen",
metaRecipeYeast.RY_NOTE[metaSize]):"tabRecipeGrains"==selectedRow.tab?(rcp2calcWeight(),c=b.hasClass("rg_amount")):"tabRecipeHops"==selectedRow.tab?rcp2calcWeight():"tabRecipeMisc"==selectedRow.tab&&(rcp2calcVolume(),rcp2calcWeight()),b=""+selectedRow.tab,b=b.right(b.length-9),$divToolbarTabs.tabs("select",idxTabs[b]),void 0!=window["qry"+b])window["recipe"+b+"Find"](),c&&$divToolbarTabs.tabs("select",idxTabs.Convert)}};
recipeScale=function(){var a=parseFloat($("#to_v"+$Recipe.re_vunits[0].selectedIndex.toString()).val());if(0!=a){var b=parseFloat($Recipe.re_volume.val()),c=a/b,e=0;$Recipe.re_volume.val(a);a=parseFloat($Recipe.re_boilvol.val())*c;$Recipe.re_boilvol.val(a.toFixed(2));e=0;$.each($RecipeGrains,function(a,b){if("object"==typeof b){var i=((parseFloat(b.rg_amount.val())||0)*c).toFixed(2);b.rg_amount.val(i);e+=parseFloat(i)}});$Recipe.re_grnamt.val(e.toFixed(2));e=0;$.each($RecipeHops,function(a,b){if("object"==
typeof b){var i=((parseFloat(b.rh_amount.val())||0)*c).toFixed(2);b.rh_amount.val(i);e+=parseFloat(i)}});$Recipe.re_hopamt.val(e.toFixed(2));e=0;$.each($RecipeMisc,function(a,b){if("object"==typeof b){var i=((parseFloat(b.rm_amount.val())||0)*c).toFixed(2);b.rm_amount.val(i);e+=parseFloat(i)}})}};
recipeScaleShow=function(){calcClear("v",$Recipe.re_vunits.val(),parseFloat($Recipe.re_volume[0].value)||0);ucalcCalc("v");var a=$("#tabVolume").find("tbody");a.find("tr:gt(5)").hide();$winModal.dialog("option","title","Scale Recipe");$winModal.bind("dialogclose",function(){var a=$("#tabModal").find("tbody");a.find("tr:gt(5)").show();$("#tabVolume").append(a)});$winModal.dialog("option","buttons",{Scale:function(){$(this).dialog("close");recipeScale()},Clear:function(){calcClear("v")},Cancel:function(){$(this).dialog("close")}});
$("#tabModal").append(a);$winModal.dialog("open")};recipeShowBrewed=function(){RCP.qryRecipe.DATA[0].RE_BREWED?($("#trBrewed").show(),$Recipe.re_brewed[0].value=jsDateFormat(new Date(RCP.qryRecipe.DATA[0].RE_BREWED))):($("#trBrewed").hide(),$Recipe.re_brewed[0].value="")};recipeShowMash=function(){$("#RecipeTabMash").toggle()};
recipeSRM=function(){for(var a=0,b=$Recipe.re_munits.val(),c=0;c<$RecipeGrains.length;c++)if($RecipeGrains[c])var e=parseFloat($RecipeGrains[c].rg_amount[0].value),f=parseFloat($RecipeGrains[c].rg_lvb[0].value),a=a+f*e;a=convertWeight(b,a,"Lbs")/convertVolume($Recipe.re_vunits.val(),$Recipe.re_volume[0].value,"Gallons");$Recipe.re_expsrm[0].value=convertSRM(a);getById("re_expsrm2").value=$Recipe.re_expsrm[0].value};
recipeStylesAuto=function(){$Recipe.re_style.attr("autocomplete")||($Recipe.re_style.autocomplete({source:function(a,b){return recipeAutoSource(a,b,qryBJCPStyles.DATA,["ST_SUBSTYLE"])},focus:function(){return!1},select:function(a,b){recipeMiscFill(b.item);miscScatter(b.item,$("#infoMisc"));miscScrollTo();return!1}}),$Recipe.re_style.autocomplete("widget").addClass("ac_results"),$Recipe.re_style.data("autocomplete")._renderItem=function(a,b){return $("<li></li>").data("item.autocomplete",b).append("<a>"+
b.ST_SUBSTYLE+"</a>").appendTo(a)})};recipeStylesFill=function(a){$Recipe.re_style.val(a.ST_SUBSTYLE);selectedRow.rowid=a._ROWID};recipeStylesFind=function(){var a=$Recipe.re_style.val()||"",a=querySearchIdx(qryBJCPStyles,idxBJCPStyles,"ST_SUBSTYLE",a);-1!=a&&(selectedRow.rowid=a,stylesScatter(qryBJCPStyles.DATA[a],$("#infoBJCPStyles")),stylesScrollTo());recipeStylesAuto()};recipeStylesPick=function(a){a=$(a).parents("tr").data("rowid")||0;recipeStylesFill(qryBJCPStyles.DATA[a])};
recipeSumGrains=function(){for(var a=0,b=0;b<$RecipeGrains.length;b++)$RecipeGrains[b]&&(a+=parseFloat($RecipeGrains[b].rg_amount[0].value)||0);for(b=0;b<$RecipeGrains.length;b++)$RecipeGrains[b]&&($RecipeGrains[b].rg_pct[0].value=(100*((parseFloat($RecipeGrains[b].rg_amount[0].value)||0)/a)).toFixed(1));$Recipe.re_grnamt[0].value=a.toFixed(2)};
recipeSumHops=function(){for(var a=0,b=0,c=0;c<$RecipeHops.length;c++)$RecipeHops[c]&&(a+=parseFloat($RecipeHops[c].rh_amount[0].value)||0,b+=parseFloat($RecipeHops[c].rh_ibu[0].value));$Recipe.re_hopamt[0].value=a.toFixed(2);$Recipe.re_expibu[0].value=b.toFixed(0);getById("re_expibu2").value=$Recipe.re_expibu[0].value};
recipeTabLoadedTB=function(a,b){var c=b.tab.text;"Grains"==c?recipeGrainsFind():"Hops"==c?recipeHopsFind():"Yeast"==c?recipeYeastFind():"Misc"==c?recipeMiscFind():"Styles"==c&&recipeStylesFind();c=$(b.panel).show();recipeTabSetMode(c,!0)};recipeTabSelectedTB=function(a,b){if(!b.panel.childElementCount){var c=$(b.panel).show();recipeTabSetMode(c)}};
recipeTabSetMode=function(a,b){b?($("#divToolbarLoading").fadeOut(2300),a.hide(),a.css({position:"static",left:0}),a.fadeIn(1500)):(a.css({position:"relative",left:"-9999px"}),$("#divToolbarLoading").show().attr("class","").addClass(a[0].id.replace("divToolbar","").toLowerCase()))};recipeTabShow=function(a,b){"Notebook"==b.tab.text&&"RecipeDates"!=selectedRow.tab&&$RecipeDates[0]&&($RecipeDates[0].rd_date.focus(),recipeRowEdit())};
recipeToggleBorders=function(a){"tabRecipe"==selectedRow.tab?a.toggleClass("edit"):a.find("tbody").find("tr").find("td").each(function(){var a=$("#"+this.id+selectedRow.row),c=a[0].type;a.attr("readOnly")||("button"==c&&(c=a.hasClass("butRotate")?"button":"nope"),("text"==c||"select-one"==c||"button"==c)&&a.toggleClass("edit"))})};recipeToolbarDock=function(){$("#divToolbar").css("left","")};
recipeToolbarToggle=function(a){var b=!a?"toolbarOut":"toolbarIn",a=!a?"toolbarIn":"toolbarOut";$("#divRight").removeClass(a).addClass(b);$divToolbarTabs.removeClass(a).addClass(b);$("#divToolbarTabWrap").removeClass(a).addClass(b);$("#ulToolbarTabs").removeClass(a).addClass(b);$("#divToolbarButtons").removeClass(a).addClass(b)};
recipeUnitsGrains=function(){var a=$Recipe.re_munits.val(),b=$Recipe.re_munits[0].oldvalue||a;$Recipe.re_munits[0].oldvalue=a;for(var c=0,e=0;e<$RecipeGrains.length;e++)$RecipeGrains[e]&&($RecipeGrains[e].rg_amount[0].value=convertWeight(b,$RecipeGrains[e].rg_amount[0].value,a).toFixed(2),c+=parseFloat($RecipeGrains[e].rg_amount[0].value));$Recipe.re_grnamt[0].value=c.toFixed(2)};
recipeUnitsGravity=function(a){var b=a.value,a=rotateGravity(a);$Recipe.re_expgrv[0].value=formatGravity(convertGravity(b,$Recipe.re_expgrv[0].value,a),a);getById("re_expgrv2").value=$Recipe.re_expgrv[0].value;for(var c=0;c<$RecipeDates.length;c++)$RecipeDates[c]&&($RecipeDates[c].rd_gravity[0].value=formatGravity(convertGravity(b,$RecipeDates[c].rd_gravity[0].value,a),a));$("#disp_eunits").html(a);spinnerBindGravity($("#rd_gravity"),a,spinnerInc)};
recipeUnitsHops=function(){var a=$Recipe.re_hunits.val(),b=$Recipe.re_hunits[0].oldvalue||a;$Recipe.re_hunits[0].oldvalue=a;for(var c=0,e=0;e<$RecipeHops.length;e++)$RecipeHops[e]&&($RecipeHops[e].rh_amount[0].value=convertWeight(b,$RecipeHops[e].rh_amount[0].value,a).toFixed(2),c+=parseFloat($RecipeHops[e].rh_amount[0].value));$Recipe.re_hopamt[0].value=c.toFixed(2)};
recipeUnitsTemp=function(a){for(var a=rotateTemp(a),b="F"==a?"C":"F",c=0;c<$RecipeDates.length;c++)$RecipeDates[c]&&($RecipeDates[c].rd_temp[0].value=formatTemp(convertTemp(b,$RecipeDates[c].rd_temp[0].value,a),a));b=$("#rd_temp").data("events");a="F"==a?{inc:1,maxVal:212,minInc:0.5,maxInc:10,decimals:0,minVal:0}:{inc:1,maxVal:100,minInc:0.5,maxInc:5,decimals:1,minVal:-10};b.change[0].data=a;b.keydown[0].data=a};
recipeVolumeUnits=function(){var a=$Recipe.re_vunits.val(),b=$Recipe.re_vunits[0].oldvalue||a;$Recipe.re_vunits[0].oldvalue=a;$Recipe.re_volume[0].value=convertVolume(b,$Recipe.re_volume[0].value,a).toFixed(2);$Recipe.re_boilvol[0].value=convertVolume(b,$Recipe.re_boilvol[0].value,a).toFixed(2)};
recipeYeastAuto=function(){var a=$RecipeYeast[selectedRow.row].ry_yeast;a.attr("autocomplete")||(a.autocomplete({source:function(a,c){return recipeAutoSource(a,c,qryYeast.DATA,["YE_YEAST","YE_MFGNO","YE_MFG"])},focus:function(){return!1},select:function(a,c){recipeYeastFill(c.item);yeastScatter(c.item,$("#infoYeast"));yeastScrollTo();return!1}}),a.autocomplete("widget").addClass("ac_results"),a.data("autocomplete")._renderItem=function(a,c){return $("<li></li>").data("item.autocomplete",c).append("<a>"+
c.YE_YEAST+", "+c.YE_MFGNO+" - "+c.YE_MFG+"</a>").appendTo(a)})};recipeYeastFill=function(a){$RecipeYeast[selectedRow.row].ry_yeast[0].value=a.YE_YEAST;$RecipeYeast[selectedRow.row].ry_mfgno[0].value=a.YE_MFGNO;$RecipeYeast[selectedRow.row].ry_mfg[0].value=a.YE_MFG;$RecipeYeast[selectedRow.row].ry_note[0].focus();selectedRow.rowid=a._ROWID};
recipeYeastFind=function(){if($RecipeYeast.length){var a=0;"tabRecipeYeast"==selectedRow.tab&&(a=selectedRow.row,recipeYeastAuto());var b=$("#ry_yeast"+a).val(),a=$("#ry_mfgno"+a).val(),b=querySearchIdx(qryYeast,idxYeast,"YE_YEAST",b,"YE_MFGNO",a);-1!=b&&(selectedRow.rowid=b,yeastScatter(qryYeast.DATA[b],$("#infoYeast")),yeastScrollTo())}};
recipeYeastNote=function(a){var b=$("#tabNotes").find("tbody");$winModal.bind("dialogclose",function(){$("#tabNotes").append($("#tabModal").find("tbody"))});$winModal.dialog("option","buttons",{Save:function(){$(this).dialog("close");$note_data.val($note_edit.val().pipeCRLF(1))},Cancel:function(){$(this).dialog("close")}});$("#tabModal").append(b);$note_data=$(a).siblings("input");$note_data.focus();$note_edit.val($note_data.val().pipeCRLF(0));a=$note_data.data("row");a="Yeast Notes: "+$RecipeYeast[a].ry_yeast.val()+
" "+$RecipeYeast[a].ry_mfg.val()+" "+$RecipeYeast[a].ry_mfgno.val();$winModal.dialog("option","title",a);textareaMaxLen($note_edit[0]);$winModal.dialog("open")};recipeYeastPick=function(a){"tabRecipeYeast"==selectedRow.tab&&(a=$(a).parents("tr").data("rowid")||0,recipeYeastFill(qryYeast.DATA[a]))};
optsAvatar=function(a){"g"==a?($("#imgAvatar").attr("src",bihPath.img+"/trans.gif"),$("#imgGravatar").attr("src",src_gravatar),$btnAvatar.addClass("ui-state-disabled"),$btnAvatar.find(".ui-button-icon-primary").removeClass("bih-icon-checked1").addClass("bih-icon-checked0"),$btnGravatar.removeClass("ui-state-disabled"),$btnGravatar.find(".ui-button-icon-primary").removeClass("bih-icon-checked0").addClass("bih-icon-checked1")):($("#imgAvatar").attr("src","usercontent/avatars/"+src_avatar),$("#imgGravatar").attr("src",
bihPath.img+"/trans.gif"),$btnAvatar.removeClass("ui-state-disabled"),$btnAvatar.find(".ui-button-icon-primary").removeClass("bih-icon-checked0").addClass("bih-icon-checked1"),$btnGravatar.addClass("ui-state-disabled"),$btnGravatar.find(".ui-button-icon-primary").removeClass("bih-icon-checked1").addClass("bih-icon-checked0"))};
optsCallBack=function(a){if(a.SUCCESS)if("Avatar"==a.DATA.METHOD){if(a.DATA.ERRORS)return showStatusWindow(a.DATA.ERRORS,500,!0);src_avatar=a.DATA.AVATAR;optsAvatar("a");showStatusWindow("Avatar file updated.")}else showStatusWindow("Settings Updated.");else cbErrors(a)};optsChangeMash=function(a){a.checked?$("#divOptsMashData").fadeIn():$("#divOptsMashData").fadeOut()};optsChangePwd=function(a){a.checked?$("#tabChgPwd").fadeIn():$("#tabChgPwd").fadeOut()};
optsInit=function(){$divOptsTabs=$("#divOptsTabs").tabs({show:optsTabShow,cache:!0,spinner:"<span class=font7>Brewing&#8230;</span>"});$us_disptunits=$("#us_disptunits");$us_dispvunits=$("#us_dispvunits");$us_dispvunits2=$("#us_dispvunits2");$us_eff=spinnerBind($("#us_eff"),incPct,spinnerInc);$us_hunits=popUnitSelect("#us_hunits",GramsConvert);$us_hydrotemp=spinnerBindTemp($("#us_hydrotemp"),bihDefaults.TUNITS,spinnerInc);$us_munits=popUnitSelect("#us_munits",GramsConvert);$us_primer=popPrimer("#us_primer");
$us_viunits=popUnitSelect("#us_viunits",LitersConvert);$us_volume=spinnerBind($("#us_volume"),incAmt,spinnerInc);$us_boilvol=spinnerBind($("#us_boilvol"),incAmt,spinnerInc);$us_vunits=popUnitSelect("#us_vunits",LitersConvert);$us_maltcap=$("#us_maltcap").bind("keydown change",{inc:0.001,maxVal:1,minInc:0.001,maxInc:0.01,decimals:3,minVal:0},spinnerInc);$us_ratio=$("#us_ratio").bind("keydown change",{inc:0.01,maxVal:5,minInc:0.01,maxInc:0.1,decimals:2,minVal:0},spinnerInc);$us_ratiounits=$("#us_ratiounits");
unitselInit(document.getElementById("us_eunits"),bihDefaults.EUNITS);unitselInit(document.getElementById("us_vunits"),bihDefaults.VUNITS);unitselInit(document.getElementById("us_viunits"),bihDefaults.VIUNITS);optsLoad();$("#frmOptions").fileupload({dataType:"json",url:bihPath.cfc+"/proxy.cfc",formData:{method:"call",args:JSON.stringify({meth:"Users.SetAvatar",data:{}})},done:function(a,b){optsCallBack(b.result)},submit:function(){$("#imgAvatar").attr("src",bihPath.img+"/ani_ajaxrun.gif")}}).find(".fileinput-button").each(function(){var a=
$(this).find("input:file").detach();$(this).button({icons:{primary:"bih-icon bih-icon-checked0"}}).append(a)});$btnAvatar=$(".fileinput-button");$btnGravatar=$("#btnGravatar");optsAvatar("a")};
optsLoad=function(){loadRowToForm(qryUser,document.frmOptions,metaUsers);$us_vunits.attr("oldvalue",qryUser.US_VUNITS);$us_viunits.attr("oldvalue",qryUser.US_VIUNITS);$us_munits.attr("oldvalue",qryUser.US_MUNITS);$us_dispvunits.html(qryUser.US_VUNITS);$us_dispvunits2.html(qryUser.US_VUNITS);$us_disptunits.html(qryUser.US_TUNITS);$us_ratiounits.html(qryUser.US_VIUNITS+"/"+qryUser.US_MUNITS)};optsReset=function(){optsLoad()};
optsSave=function(){var a=document.frmOptions;if(isEmpty(a.us_first,"First Name is required.")||isEmpty(a.us_last,"Last Name is required.")||isEmpty(a.us_email,"Email is required.")||isNotEmail(a.us_email,"Email is invalid."))return!1;if(a.chg_password.checked){if(isEmpty(a.password,"Password is required.")||isNotREMatch(a.password,/^.{5,}/,"Password must be at least 5 characters.")||isEmpty(a.password2,"Confirmed Password is required.")||isNotEqual(a.password.value,a.password2.value,"Passwords do not match."))return!1;
qryUser.US_PWD=a.password.value}loadFormToRow(a,qryUser);remoteCall("Users.Process",qryUser,optsCallBack)};optsTabShow=function(){};optsUnitsGravity=function(a){rotateGravity(a)};optsUnitsInfusion=function(){var a=$us_ratio.val(),b=$us_viunits.val(),c=$us_viunits.attr("oldvalue")||b;$us_viunits.attr("oldvalue",b);a*=convertVolume(c,1,b);$us_ratio.val(a.toFixed(2));$us_ratiounits.html($us_viunits.val()+"/"+$us_munits.val())};
optsUnitsMash=function(){var a=$us_ratio.val(),b=$us_munits.val(),c=$us_munits.attr("oldvalue")||b;$us_munits.attr("oldvalue",b);a/=convertWeight(c,1,b);$us_ratio.val(a.toFixed(2));$us_ratiounits.html($us_viunits.val()+"/"+$us_munits.val())};optsUnitsTemp=function(a){var b=a.value,a=rotateTemp(a);$us_hydrotemp.val(formatTemp(convertTemp(b,$us_hydrotemp.val(),a),a));$us_disptunits.html(a)};
optsUnitsVolume=function(){var a=$us_vunits.val(),b=$us_vunits.attr("oldvalue")||a;$us_vunits.attr("oldvalue",a);$us_volume.val(convertVolume(b,$us_volume.val(),a).toFixed(2));$us_boilvol.val(convertVolume(b,$us_boilvol.val(),a).toFixed(2));$us_dispvunits.html(a);$us_dispvunits2.html(a)};yeastClickRow=function(){var a=$(this).data("rowid")||0,b=$("#infoYeast");yeastScatter(qryYeast.DATA[a],b)};
yeastInit=function(){queryMakeHashable(qryYeast);for(var a=$("#tabYeast"),b=a.find("tbody"),c=b.find("tr"),e=0;e<qryYeast.DATA.length;e++){var f=c.clone();yeastScatter(qryYeast.DATA[e],f);f.attr("id","ye_rowid"+e);f.data("rowid",e);b.append(f)}c.remove();a.tablescroller({id:"Yeast",height:380,sort:!0,print:!1,borderWidth:1,borderColor:"#979F97"});b.find("tr").click(yeastClickRow);yeastClickRow()};
yeastScatter=function(a,b){b.find(".ye_yeast").html(a.YE_YEAST);b.find(".ye_mfgno").html(a.YE_MFGNO);b.find(".ye_mfg").html(a.YE_MFG);b.find(".ye_type").html(a.YE_TYPE);var c=formatTemp(convertTemp(a.YE_TEMPUNITS,a.YE_TEMPLOW,bihDefaults.TUNITS)),e=formatTemp(convertTemp(a.YE_TEMPUNITS,a.YE_TEMPHIGH,bihDefaults.TUNITS));"infoYeast"==b.attr("id")?(b.find(".ye_floc").html(a.YE_FLOC),b.find(".ye_at").html(a.YE_ATLOW+" - "+a.YE_ATHIGH+" %"),b.find(".ye_temp").html(c+" - "+e+" &deg;"+a.YE_TEMPUNITS.left(1)),
b.find("div.ye_info").html(a.YE_INFO),rowHighlight(b,"ye_rowid",a._ROWID)):(b.find(".ye_atlow").html(a.YE_ATLOW),b.find(".ye_athigh").html(a.YE_ATHIGH),b.find(".ye_templow").html(c),b.find(".ye_temphigh").html(e))};yeastScrollTo=function(){var a=$("#tabScrollBodyYeast").find("tbody").find("#ye_rowid"+selectedRow.rowid);$("#divScrollBodyYeast").scrollTo(a,800)};
